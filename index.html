<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoramento de Servidores - Timeline & Projeções</title>
    <!-- Chart.js via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        /* Reset e configurações gerais */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --gray-color: #95a5a6;
            --sidebar-width: 250px;
            --header-height: 60px;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        /* Layout principal */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: transform 0.3s;
            z-index: 1000;
        }

        .sidebar.collapsed {
            transform: translateX(-100%);
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }

        .sidebar-header h2 {
            color: white;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-menu li {
            margin-bottom: 5px;
        }

        .nav-menu a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s;
        }

        .nav-menu a:hover, .nav-menu a.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border-left: 4px solid var(--secondary-color);
        }

        .nav-menu i {
            width: 20px;
            text-align: center;
        }

        /* Conteúdo principal */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: margin-left 0.3s;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        /* Header */
        .header {
            height: var(--header-height);
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 25px;
            z-index: 100;
            position: sticky;
            top: 0;
        }

        .header-left, .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .sidebar-toggle {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--primary-color);
            cursor: pointer;
            padding: 5px;
        }

        .date-display {
            font-size: 0.9rem;
            color: var(--gray-color);
            font-weight: 500;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 5px 10px;
            background-color: #f8f9fa;
            border-radius: 20px;
        }

        /* Conteúdo da página */
        .page-content {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
        }

        /* Seções */
        .section {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
        }

        .section-title {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eaeaea;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .section-title i {
            color: var(--secondary-color);
        }

        /* Cards de métricas */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .metric-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--secondary-color);
            transition: transform 0.2s;
        }

        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .metric-card.critical {
            border-left-color: var(--danger-color);
        }

        .metric-card.warning {
            border-left-color: var(--warning-color);
        }

        .metric-card.success {
            border-left-color: var(--success-color);
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .metric-name {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 0.95rem;
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 10px 0;
        }

        .metric-trend {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .metric-trend.up {
            color: var(--danger-color);
        }

        .metric-trend.down {
            color: var(--success-color);
        }

        /* Gráficos */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }

        @media (max-width: 1200px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
            width: 100%;
        }

        /* Timeline de eventos */
        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: var(--secondary-color);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 25px;
            padding-left: 20px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 5px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            border: 3px solid white;
            box-shadow: 0 0 0 3px var(--secondary-color);
        }

        .timeline-date {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .timeline-content {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid var(--secondary-color);
        }

        /* Tabela */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background-color: #f8f9fa;
            color: var(--primary-color);
            font-weight: 600;
            text-align: left;
            padding: 15px;
            border-bottom: 2px solid #eaeaea;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #eaeaea;
        }

        tr:hover {
            background-color: #f9f9f9;
        }

        /* Painel de login */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--primary-color);
            padding: 20px;
        }

        .login-box {
            background-color: white;
            border-radius: 10px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .login-header p {
            color: var(--gray-color);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-color);
        }

        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        /* Botões */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #27ae60;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #d68910;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-secondary {
            background-color: var(--gray-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #7f8c8d;
        }

        .btn-block {
            width: 100%;
        }

        /* Alertas */
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .alert-warning {
            background-color: #fef5e7;
            border-left: 4px solid var(--warning-color);
            color: #9c6e0f;
        }

        .alert-critical {
            background-color: #fdedec;
            border-left: 4px solid var(--danger-color);
            color: #a93226;
        }

        .alert-info {
            background-color: #e8f4fc;
            border-left: 4px solid var(--secondary-color);
            color: var(--primary-color);
        }

        /* Filtros */
        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-label {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--primary-color);
        }

        /* Status indicators */
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-ok { background-color: var(--success-color); }
        .status-warning { background-color: var(--warning-color); }
        .status-critical { background-color: var(--danger-color); }

        /* Projeção anual */
        .annual-projection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .projection-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border-top: 4px solid var(--secondary-color);
        }

        .projection-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .projection-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 10px 0;
            color: var(--primary-color);
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .filters {
                flex-direction: column;
                align-items: stretch;
            }
        }

        /* Utilitários */
        .text-right { text-align: right; }
        .text-center { text-align: center; }
        .mb-20 { margin-bottom: 20px; }
        .mt-20 { margin-top: 20px; }
        .mt-30 { margin-top: 30px; }
        .hidden { display: none; }
        .flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .align-center { align-items: center; }
        .gap-10 { gap: 10px; }
        .full-width { width: 100%; }
        .flex-1 { flex: 1; }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-success {
            background-color: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background-color: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background-color: #f8d7da;
            color: #721c24;
        }

        /* Public dashboard */
        .public-dashboard {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .public-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .public-header h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .public-header p {
            color: var(--gray-color);
        }

        /* Novos estilos para Firebase */
        .sync-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .sync-online {
            background-color: var(--success-color);
            color: white;
        }

        .sync-offline {
            background-color: var(--warning-color);
            color: white;
        }

        .firebase-status {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            background-color: #f8f9fa;
            border-radius: 20px;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <!-- Painel de Login -->
    <div id="loginPanel" class="login-container">
        <div class="login-box">
            <div class="login-header">
                <h1><i class="fas fa-server"></i> Monitoramento de Servidores</h1>
                <p>Acesso administrativo ao painel de monitoramento</p>
            </div>
            
            <div class="form-group">
                <label for="username">Usuário</label>
                <input type="text" id="username" placeholder="Digite seu usuário" value="admin">
            </div>
            
            <div class="form-group">
                <label for="password">Senha</label>
                <input type="password" id="password" placeholder="Digite sua senha" value="ZXqwas123">
            </div>
            
            <div class="form-group">
                <button class="btn btn-primary btn-block" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i> Entrar
                </button>
            </div>
            
            <div class="text-center">
                <p>Para visualizar o painel público, <a href="#" id="publicLink">clique aqui</a></p>
            </div>
            
            <div class="alert alert-info mt-20">
                <i class="fas fa-info-circle"></i>
                <div>
                    <strong>Credenciais padrão:</strong><br>
                    Usuário: admin<br>
                    Senha: ZXqwas123
                </div>
            </div>
        </div>
    </div>

    <!-- Aplicação principal (após login) -->
    <div id="appContainer" class="app-container hidden">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-chart-line"></i> Monitoramento</h2>
            </div>
            
            <ul class="nav-menu">
                <li><a href="#dashboard" class="active"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                <li><a href="#timeline"><i class="fas fa-stream"></i> Timeline</a></li>
                <li><a href="#anexos-growth"><i class="fas fa-hdd"></i> Crescimento Anexos</a></li>
                <li><a href="#projections"><i class="fas fa-chart-area"></i> Projeções</a></li>
                <li><a href="#servers"><i class="fas fa-server"></i> Servidores</a></li>
                <li><a href="#alerts"><i class="fas fa-exclamation-triangle"></i> Alertas</a></li>
                <li><a href="#backup"><i class="fas fa-database"></i> Backup</a></li>
                <li><a href="#public-view"><i class="fas fa-eye"></i> Visualização Pública</a></li>
            </ul>
            
            <div style="padding: 20px; margin-top: auto;">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <div style="font-size: 0.85rem;">
                        <strong>Foco:</strong> Monitorar crescimento da unidade "anexos" no app-server
                    </div>
                </div>
                <div class="firebase-status" id="firebaseStatus">
                    <i class="fas fa-database"></i>
                    <span>Firebase: Conectando...</span>
                </div>
            </div>
        </div>

        <!-- Conteúdo principal -->
        <div class="main-content" id="mainContent">
            <!-- Header -->
            <div class="header">
                <div class="header-left">
                    <button class="sidebar-toggle" id="sidebarToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="date-display" id="currentDate"></div>
                    <div class="sync-status" id="syncStatus">Conectando...</div>
                </div>
                
                <div class="header-right">
                    <div class="user-info">
                        <i class="fas fa-user-circle"></i>
                        <span id="currentUser">admin</span>
                    </div>
                    <button class="btn btn-secondary" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>

            <!-- Conteúdo das páginas -->
            <div class="page-content">
                <!-- Dashboard -->
                <section id="dashboard" class="page-section">
                    <div class="section">
                        <h2 class="section-title">
                            <i class="fas fa-tachometer-alt"></i> Dashboard de Monitoramento
                            <span class="badge badge-success" id="lastUpdateTime"></span>
                        </h2>
                        
                        <!-- Cards de métricas -->
                        <div class="metrics-grid" id="metricsGrid">
                            <!-- Será preenchido por JavaScript -->
                        </div>
                        
                        <!-- Gráficos principais -->
                        <div class="charts-grid">
                            <div class="chart-container">
                                <div class="chart-header">
                                    <h3>Uso de CPU ao Longo do Tempo</h3>
                                    <select id="cpuServerFilter">
                                        <option value="all">Todos os servidores</option>
                                        <option value="app-server">app-server</option>
                                        <option value="db-server">db-server</option>
                                    </select>
                                </div>
                                <div class="chart-wrapper">
                                    <canvas id="cpuChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="chart-container">
                                <div class="chart-header">
                                    <h3>Uso de Memória ao Longo do Tempo</h3>
                                    <select id="memoryServerFilter">
                                        <option value="all">Todos os servidores</option>
                                        <option value="app-server">app-server</option>
                                        <option value="db-server">db-server</option>
                                    </select>
                                </div>
                                <div class="chart-wrapper">
                                    <canvas id="memoryChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Gráficos de disco -->
                        <div class="charts-grid">
                            <div class="chart-container">
                                <div class="chart-header">
                                    <h3>Uso de Disco - Partição Anexos (app-server)</h3>
                                </div>
                                <div class="chart-wrapper">
                                    <canvas id="anexosChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="chart-container">
                                <div class="chart-header">
                                    <h3>Disponibilidade dos Servidores</h3>
                                </div>
                                <div class="chart-wrapper">
                                    <canvas id="availabilityChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Timeline -->
                <section id="timeline" class="page-section hidden">
                    <div class="section">
                        <h2 class="section-title">
                            <i class="fas fa-stream"></i> Timeline de Eventos e Métricas
                        </h2>
                        
                        <div class="filters">
                            <div class="filter-group">
                                <div class="filter-label">Servidor</div>
                                <select id="timelineServerFilter">
                                    <option value="all">Todos os servidores</option>
                                    <option value="app-server">app-server</option>
                                    <option value="db-server">db-server</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <div class="filter-label">Período</div>
                                <select id="timelinePeriodFilter">
                                    <option value="7">Últimos 7 dias</option>
                                    <option value="30" selected>Últimos 30 dias</option>
                                    <option value="90">Últimos 90 dias</option>
                                    <option value="365">Últimos 365 dias</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <div class="filter-label">Ordenar por</div>
                                <select id="timelineSortFilter">
                                    <option value="date-desc">Data (mais recente)</option>
                                    <option value="date-asc">Data (mais antiga)</option>
                                </select>
                            </div>
                            
                            <button class="btn btn-primary" id="applyTimelineFilters">
                                <i class="fas fa-filter"></i> Aplicar
                            </button>
                        </div>
                        
                        <div class="timeline" id="timelineContainer">
                            <!-- Será preenchido por JavaScript -->
                        </div>
                    </div>
                </section>

                <!-- Crescimento Anexos -->
                <section id="anexos-growth" class="page-section hidden">
                    <div class="section">
                        <h2 class="section-title">
                            <i class="fas fa-hdd"></i> Monitoramento de Crescimento - Unidade Anexos
                        </h2>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <div>
                                <strong>Unidade "anexos" - app-server:</strong> Monitoramento detalhado do crescimento desta unidade de disco adicional.
                                <div class="mt-10" id="anexosSummary">
                                    <!-- Resumo será preenchido por JavaScript -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="charts-grid">
                            <div class="chart-container">
                                <div class="chart-header">
                                    <h3>Crescimento Diário - Anexos (GB)</h3>
                                    <button class="btn btn-secondary" id="exportAnexosData">
                                        <i class="fas fa-download"></i> Exportar Dados
                                    </button>
                                </div>
                                <div class="chart-wrapper">
                                    <canvas id="anexosGrowthChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="chart-container">
                                <div class="chart-header">
                                    <h3>Taxa de Crescimento Diário</h3>
                                </div>
                                <div class="chart-wrapper">
                                    <canvas id="growthRateChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Estatísticas de crescimento -->
                        <div class="metrics-grid">
                            <div class="metric-card">
                                <div class="metric-header">
                                    <div class="metric-name">Uso Atual (GB)</div>
                                    <div class="status-indicator status-ok"></div>
                                </div>
                                <div class="metric-value" id="currentAnexosUsage">--</div>
                                <div class="metric-trend">
                                    <span id="anexosTrend">--</span>
                                </div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-header">
                                    <div class="metric-name">Crescimento Médio Diário</div>
                                    <div class="status-indicator status-ok"></div>
                                </div>
                                <div class="metric-value" id="avgDailyGrowth">--</div>
                                <div class="metric-trend">
                                    <span>GB/dia</span>
                                </div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-header">
                                    <div class="metric-name">Dias até 90% de Uso</div>
                                    <div class="status-indicator status-ok"></div>
                                </div>
                                <div class="metric-value" id="daysTo90Percent">--</div>
                                <div class="metric-trend">
                                    <span>dias</span>
                                </div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-header">
                                    <div class="metric-name">Data Estimada 90%</div>
                                    <div class="status-indicator status-ok"></div>
                                </div>
                                <div class="metric-value" id="estimated90Date">--</div>
                                <div class="metric-trend">
                                    <span>aproximadamente</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tabela de histórico -->
                        <div class="section-title mt-30">
                            <h3><i class="fas fa-history"></i> Histórico de Uso - Anexos</h3>
                        </div>
                        
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Dia</th>
                                        <th>Uso (GB)</th>
                                        <th>Crescimento Diário</th>
                                        <th>% de Uso</th>
                                        <th>Disponibilidade</th>
                                    </tr>
                                </thead>
                                <tbody id="anexosHistoryTable">
                                    <!-- Será preenchido por JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Projeções -->
                <section id="projections" class="page-section hidden">
                    <div class="section">
                        <h2 class="section-title">
                            <i class="fas fa-chart-area"></i> Projeções de Uso - 1 Ano
                        </h2>
                        
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div>
                                <strong>Projeção baseada em regressão linear:</strong> As estimativas são calculadas com base no crescimento histórico e podem não refletir eventos futuros.
                            </div>
                        </div>
                        
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3>Projeção de Uso - Unidade Anexos (1 Ano)</h3>
                                <div>
                                    <span class="filter-label">Período de Projeção: </span>
                                    <select id="projectionPeriod">
                                        <option value="30">30 dias</option>
                                        <option value="90">90 dias</option>
                                        <option value="180">180 dias</option>
                                        <option value="365" selected>365 dias (1 ano)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="chart-wrapper">
                                <canvas id="annualProjectionChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Cards de projeção anual -->
                        <div class="annual-projection">
                            <div class="projection-card">
                                <div class="projection-title">Projeção para 30 dias</div>
                                <div class="projection-value" id="projection30Days">-- GB</div>
                                <div class="metric-trend">
                                    <span id="projection30Trend">--</span>
                                </div>
                            </div>
                            
                            <div class="projection-card">
                                <div class="projection-title">Projeção para 90 dias</div>
                                <div class="projection-value" id="projection90Days">-- GB</div>
                                <div class="metric-trend">
                                    <span id="projection90Trend">--</span>
                                </div>
                            </div>
                            
                            <div class="projection-card">
                                <div class="projection-title">Projeção para 180 dias</div>
                                <div class="projection-value" id="projection180Days">-- GB</div>
                                <div class="metric-trend">
                                    <span id="projection180Trend">--</span>
                                </div>
                            </div>
                            
                            <div class="projection-card">
                                <div class="projection-title">Projeção para 365 dias (1 ano)</div>
                                <div class="projection-value" id="projection365Days">-- GB</div>
                                <div class="metric-trend">
                                    <span id="projection365Trend">--</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Estatísticas de projeção -->
                        <div class="section-title mt-30">
                            <h3><i class="fas fa-calculator"></i> Estatísticas de Projeção</h3>
                        </div>
                        
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Período</th>
                                        <th>Uso Projetado (GB)</th>
                                        <th>% de Uso Projetado</th>
                                        <th>Crescimento Total (GB)</th>
                                        <th>Data Estimada</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="projectionStatsTable">
                                    <!-- Será preenchido por JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Servidores -->
                <section id="servers" class="page-section hidden">
                    <div class="section">
                        <h2 class="section-title">
                            <i class="fas fa-server"></i> Gerenciamento de Servidores
                        </h2>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <div>
                                <strong>Adicionar novo snapshot:</strong> Use o formulário abaixo para registrar métricas diárias dos servidores.
                            </div>
                        </div>
                        
                        <!-- Formulário para adicionar snapshot -->
                        <div class="charts-grid">
                            <div class="chart-container">
                                <h3 class="mb-20">Adicionar Snapshot Diário</h3>
                                
                                <div class="form-group">
                                    <label for="snapshotServer">Servidor</label>
                                    <select id="snapshotServer" class="full-width">
                                        <option value="app-server">app-server</option>
                                        <option value="db-server">db-server</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="snapshotPartition">Partição de Disco</label>
                                    <select id="snapshotPartition" class="full-width">
                                        <option value="root">root</option>
                                        <option value="anexos">anexos</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="snapshotTimestamp">Data/Hora</label>
                                    <input type="datetime-local" id="snapshotTimestamp" class="full-width">
                                </div>
                                
                                <div class="form-group">
                                    <label for="snapshotCpu">CPU % (0-100)</label>
                                    <input type="number" id="snapshotCpu" min="0" max="100" step="0.1" class="full-width">
                                </div>
                                
                                <div class="form-group">
                                    <label for="snapshotMemory">Memória % (0-100)</label>
                                    <input type="number" id="snapshotMemory" min="0" max="100" step="0.1" class="full-width">
                                </div>
                            </div>
                            
                            <div class="chart-container">
                                <h3 class="mb-20" style="visibility: hidden;">.</h3>
                                
                                <div class="form-group">
                                    <label for="snapshotDiskTotal">Disco Total (GB)</label>
                                    <input type="number" id="snapshotDiskTotal" min="1" step="0.1" class="full-width">
                                </div>
                                
                                <div class="form-group">
                                    <label for="snapshotDiskUsed">Disco Usado (GB)</label>
                                    <input type="number" id="snapshotDiskUsed" min="0" step="0.1" class="full-width">
                                </div>
                                
                                <div class="form-group">
                                    <label for="snapshotAvailability">Disponibilidade % (0-100)</label>
                                    <input type="number" id="snapshotAvailability" min="0" max="100" step="0.1" class="full-width">
                                </div>
                                
                                <div class="form-group">
                                    <label for="snapshotProcessCount">Contagem de Processos</label>
                                    <input type="number" id="snapshotProcessCount" min="0" class="full-width">
                                </div>
                                
                                <div class="form-group">
                                    <label for="snapshotServices">Serviços em Execução</label>
                                    <input type="number" id="snapshotServices" min="0" class="full-width">
                                </div>
                                
                                <div class="form-group">
                                    <label for="snapshotNotes">Notas (opcional)</label>
                                    <textarea id="snapshotNotes" rows="2" class="full-width"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-between mt-20">
                            <button class="btn btn-success" id="addSnapshotBtn">
                                <i class="fas fa-save"></i> Adicionar Snapshot
                            </button>
                            
                            <button class="btn btn-secondary" id="clearFormBtn">
                                <i class="fas fa-broom"></i> Limpar Formulário
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Alertas -->
                <section id="alerts" class="page-section hidden">
                    <div class="section">
                        <h2 class="section-title">
                            <i class="fas fa-exclamation-triangle"></i> Alertas e Limiares
                        </h2>
                        
                        <div class="alert alert-warning">
                            <i class="fas fa-cog"></i>
                            <div>
                                <strong>Configurar limiares:</strong> Defina os valores de alerta para cada métrica.
                            </div>
                        </div>
                        
                        <!-- Configuração de limiares -->
                        <div class="charts-grid">
                            <div class="chart-container">
                                <h3 class="mb-20">Configuração de Limiares</h3>
                                
                                <div class="form-group">
                                    <label for="cpuThreshold">Limiar de CPU %</label>
                                    <input type="number" id="cpuThreshold" min="0" max="100" value="85" class="full-width">
                                </div>
                                
                                <div class="form-group">
                                    <label for="memoryThreshold">Limiar de Memória %</label>
                                    <input type="number" id="memoryThreshold" min="0" max="100" value="85" class="full-width">
                                </div>
                                
                                <div class="form-group">
                                    <label for="diskThreshold">Limiar de Disco %</label>
                                    <input type="number" id="diskThreshold" min="0" max="100" value="90" class="full-width">
                                </div>
                                
                                <div class="form-group">
                                    <label for="availabilityThreshold">Limiar de Disponibilidade %</label>
                                    <input type="number" id="availabilityThreshold" min="0" max="100" value="99" class="full-width">
                                </div>
                                
                                <button class="btn btn-primary full-width mt-20" id="saveThresholdsBtn">
                                    <i class="fas fa-save"></i> Salvar Limiares
                                </button>
                            </div>
                            
                            <div class="chart-container">
                                <h3 class="mb-20">Alertas Ativos</h3>
                                <div id="activeAlertsContainer">
                                    <!-- Alertas serão preenchidos por JavaScript -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Histórico de alertas -->
                        <div class="section-title mt-30">
                            <h3><i class="fas fa-history"></i> Histórico de Alertas</h3>
                        </div>
                        
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Data/Hora</th>
                                        <th>Servidor</th>
                                        <th>Tipo</th>
                                        <th>Métrica</th>
                                        <th>Valor</th>
                                        <th>Limiar</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="alertsHistoryTable">
                                    <!-- Será preenchido por JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Backup -->
                <section id="backup" class="page-section hidden">
                    <div class="section">
                        <h2 class="section-title">
                            <i class="fas fa-database"></i> Backup e Restauração de Dados
                        </h2>
                        
                        <div class="charts-grid">
                            <div class="chart-container">
                                <h3 class="mb-20">Exportar Dados</h3>
                                
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle"></i>
                                    <div>
                                        <strong>Backup completo:</strong> Exporte todos os dados de monitoramento em formato JSON.
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="exportFormat">Formato de Exportação</label>
                                    <select id="exportFormat" class="full-width">
                                        <option value="json">JSON Completo</option>
                                        <option value="csv">CSV (para planilhas)</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="exportDateRange">Intervalo de Datas</label>
                                    <select id="exportDateRange" class="full-width">
                                        <option value="all">Todos os dados</option>
                                        <option value="30">Últimos 30 dias</option>
                                        <option value="90">Últimos 90 dias</option>
                                        <option value="365">Últimos 365 dias</option>
                                    </select>
                                </div>
                                
                                <button class="btn btn-success full-width mt-20" id="exportDataBtn">
                                    <i class="fas fa-download"></i> Exportar Dados
                                </button>
                                
                                <button class="btn btn-secondary full-width mt-10" id="exportAnexosOnlyBtn">
                                    <i class="fas fa-hdd"></i> Exportar Somente Dados Anexos
                                </button>

                                <!-- Botão de sincronização -->
                                <button class="btn btn-primary full-width mt-10" id="syncWithFirebaseBtn">
                                    <i class="fas fa-sync-alt"></i> Sincronizar Dados Locais com Firebase
                                </button>
                            </div>
                            
                            <div class="chart-container">
                                <h3 class="mb-20">Importar Dados</h3>
                                
                                <div class="alert alert-warning">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <div>
                                        <strong>Atenção:</strong> A importação substituirá dados com o mesmo timestamp.
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="importData">Cole o JSON aqui</label>
                                    <textarea id="importData" rows="8" class="full-width" placeholder="Cole os dados JSON aqui..."></textarea>
                                </div>
                                
                                <div class="flex gap-10">
                                    <button class="btn btn-primary flex-1" id="importJsonBtn">
                                        <i class="fas fa-file-import"></i> Importar JSON
                                    </button>
                                    
                                    <button class="btn btn-warning flex-1" id="importFileBtn">
                                        <i class="fas fa-upload"></i> Carregar Arquivo
                                    </button>
                                </div>
                                
                                <div class="form-group mt-20">
                                    <label for="clearData">Limpar Dados</label>
                                    <div class="flex gap-10">
                                        <button class="btn btn-danger flex-1" id="clearAllDataBtn">
                                            <i class="fas fa-trash"></i> Limpar Todos os Dados
                                        </button>
                                        
                                        <button class="btn btn-secondary flex-1" id="resetDemoDataBtn">
                                            <i class="fas fa-redo"></i> Restaurar Dados Demo
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Estatísticas de dados -->
                        <div class="section-title mt-30">
                            <h3><i class="fas fa-chart-bar"></i> Estatísticas dos Dados</h3>
                        </div>
                        
                        <div class="metrics-grid">
                            <div class="metric-card">
                                <div class="metric-header">
                                    <div class="metric-name">Total de Registros</div>
                                </div>
                                <div class="metric-value" id="totalRecords">--</div>
                                <div class="metric-trend">
                                    <span id="recordsTrend">--</span>
                                </div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-header">
                                    <div class="metric-name">Primeiro Registro</div>
                                </div>
                                <div class="metric-value" id="firstRecordDate">--</div>
                                <div class="metric-trend">
                                    <span>Data inicial</span>
                                </div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-header">
                                    <div class="metric-name">Último Registro</div>
                                </div>
                                <div class="metric-value" id="lastRecordDate">--</div>
                                <div class="metric-trend">
                                    <span>Data mais recente</span>
                                </div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-header">
                                    <div class="metric-name">Tamanho dos Dados</div>
                                </div>
                                <div class="metric-value" id="dataSize">--</div>
                                <div class="metric-trend">
                                    <span>KB</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Visualização Pública -->
                <section id="public-view" class="page-section hidden">
                    <div class="section">
                        <h2 class="section-title">
                            <i class="fas fa-eye"></i> Visualização Pública
                        </h2>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <div>
                                <strong>Painel público:</strong> Esta visualização pode ser compartilhada com usuários não administrativos.
                                <button class="btn btn-primary mt-10" id="openPublicDashboard">
                                    <i class="fas fa-external-link-alt"></i> Abrir Painel Público em Nova Janela
                                </button>
                            </div>
                        </div>
                        
                        <div id="publicDashboardPreview">
                            <!-- Pré-visualização do painel público -->
                            <div class="public-dashboard">
                                <div class="public-header">
                                    <h1>Monitoramento de Servidores - Visualização Pública</h1>
                                    <p>Status atual dos servidores e métricas de desempenho</p>
                                </div>
                                
                                <div class="metrics-grid" id="publicMetricsPreview">
                                    <!-- Será preenchido por JavaScript -->
                                </div>
                                
                                <div class="chart-container mt-30">
                                    <div class="chart-header">
                                        <h3>Uso de Disco - Unidade Anexos (app-server)</h3>
                                    </div>
                                    <div class="chart-wrapper">
                                        <canvas id="publicAnexosChart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="chart-container mt-30">
                                    <div class="chart-header">
                                        <h3>Disponibilidade dos Servidores</h3>
                                    </div>
                                    <div class="chart-wrapper">
                                        <canvas id="publicAvailabilityChart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="section-title mt-30">
                                    <h3><i class="fas fa-exclamation-triangle"></i> Status de Alertas</h3>
                                </div>
                                
                                <div id="publicAlertsPreview" class="mt-20">
                                    <!-- Será preenchido por JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Input oculto para importação de arquivo -->
    <input type="file" id="fileInput" accept=".json,.csv" style="display: none;">

    <script>
        // ==============================================
        // CONFIGURAÇÃO DO FIREBASE
        // ==============================================
        
        const firebaseConfig = {
            apiKey: "AIzaSyDMZMnUgrSidkhhRSGseSfsVY71aKKaD6s",
            authDomain: "esusmonitoramento-cb9d9.firebaseapp.com",
            projectId: "esusmonitoramento-cb9d9",
            storageBucket: "esusmonitoramento-cb9d9.firebasestorage.app",
            messagingSenderId: "270924557644",
            appId: "1:270924557644:web:920bd5ea08618eebc633e9",
            measurementId: "G-WECBVPST4T"
        };

        // Inicializar Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            console.log("Firebase inicializado com sucesso!");
            updateFirebaseStatus('Conectado', 'success');
        } catch (error) {
            console.error("Erro ao inicializar Firebase:", error);
            updateFirebaseStatus('Erro: ' + error.message, 'danger');
        }

        const db = firebase.firestore();
        const auth = firebase.auth();

        // ==============================================
        // DADOS E CONFIGURAÇÕES
        // ==============================================
        
        // Dados de demonstração iniciais
        const demoData = [
            {"timestamp":"2025-10-25T08:00:00Z","server":"app-server","cpu_percent":12.3,"memory_percent":45.0,"disk_total_gb":200,"disk_used_gb":30.2,"disk_partition":"anexos","availability_percent":99.9,"process_count":95,"services_running":25,"notes":""},
            {"timestamp":"2025-10-26T08:00:00Z","server":"app-server","cpu_percent":15.6,"memory_percent":47.8,"disk_total_gb":200,"disk_used_gb":31.4,"disk_partition":"anexos","availability_percent":99.8,"process_count":98,"services_running":25,"notes":""},
            {"timestamp":"2025-10-27T08:00:00Z","server":"db-server","cpu_percent":22.1,"memory_percent":60.4,"disk_total_gb":500,"disk_used_gb":150.2,"disk_partition":"root","availability_percent":99.7,"process_count":210,"services_running":40,"notes":""},
            {"timestamp":"2025-10-28T08:00:00Z","server":"app-server","cpu_percent":18.9,"memory_percent":46.5,"disk_total_gb":200,"disk_used_gb":32.1,"disk_partition":"anexos","availability_percent":99.95,"process_count":101,"services_running":26,"notes":""},
            {"timestamp":"2025-10-29T08:00:00Z","server":"db-server","cpu_percent":25.0,"memory_percent":62.2,"disk_total_gb":500,"disk_used_gb":151.3,"disk_partition":"root","availability_percent":99.6,"process_count":215,"services_running":41,"notes":""},
            {"timestamp":"2025-10-30T08:00:00Z","server":"app-server","cpu_percent":20.1,"memory_percent":48.2,"disk_total_gb":200,"disk_used_gb":33.0,"disk_partition":"anexos","availability_percent":99.9,"process_count":105,"services_running":27,"notes":"backup automático"},
            {"timestamp":"2025-10-31T08:00:00Z","server":"db-server","cpu_percent":28.5,"memory_percent":65.3,"disk_total_gb":500,"disk_used_gb":152.8,"disk_partition":"root","availability_percent":99.5,"process_count":220,"services_running":42,"notes":"pico de carga"},
            {"timestamp":"2025-11-01T08:00:00Z","server":"app-server","cpu_percent":19.5,"memory_percent":47.1,"disk_total_gb":200,"disk_used_gb":34.2,"disk_partition":"anexos","availability_percent":99.85,"process_count":108,"services_running":27,"notes":""},
            {"timestamp":"2025-11-02T08:00:00Z","server":"db-server","cpu_percent":26.8,"memory_percent":63.7,"disk_total_gb":500,"disk_used_gb":154.1,"disk_partition":"root","availability_percent":99.7,"process_count":218,"services_running":41,"notes":""},
            {"timestamp":"2025-11-03T08:00:00Z","server":"app-server","cpu_percent":22.4,"memory_percent":49.8,"disk_total_gb":200,"disk_used_gb":35.5,"disk_partition":"anexos","availability_percent":99.9,"process_count":110,"services_running":28,"notes":"deploy anexo v1"},
            {"timestamp":"2025-11-04T08:00:00Z","server":"app-server","cpu_percent":21.7,"memory_percent":48.9,"disk_total_gb":200,"disk_used_gb":36.8,"disk_partition":"anexos","availability_percent":99.8,"process_count":112,"services_running":28,"notes":""},
            {"timestamp":"2025-11-05T08:00:00Z","server":"db-server","cpu_percent":27.3,"memory_percent":64.5,"disk_total_gb":500,"disk_used_gb":155.5,"disk_partition":"root","availability_percent":99.6,"process_count":222,"services_running":42,"notes":""},
            {"timestamp":"2025-11-06T08:00:00Z","server":"app-server","cpu_percent":23.1,"memory_percent":50.2,"disk_total_gb":200,"disk_used_gb":38.1,"disk_partition":"anexos","availability_percent":99.9,"process_count":115,"services_running":29,"notes":"novos anexos"},
            {"timestamp":"2025-11-07T08:00:00Z","server":"db-server","cpu_percent":29.2,"memory_percent":66.1,"disk_total_gb":500,"disk_used_gb":157.2,"disk_partition":"root","availability_percent":99.4,"process_count":225,"services_running":43,"notes":"manutenção agendada"},
            {"timestamp":"2025-11-08T08:00:00Z","server":"app-server","cpu_percent":24.5,"memory_percent":51.7,"disk_total_gb":200,"disk_used_gb":39.9,"disk_partition":"anexos","availability_percent":99.7,"process_count":118,"services_running":30,"notes":"pico de uploads"},
            {"timestamp":"2025-11-09T08:00:00Z","server":"db-server","cpu_percent":26.4,"memory_percent":63.8,"disk_total_gb":500,"disk_used_gb":158.8,"disk_partition":"root","availability_percent":99.8,"process_count":219,"services_running":41,"notes":""},
            {"timestamp":"2025-11-10T08:00:00Z","server":"app-server","cpu_percent":20.8,"memory_percent":49.3,"disk_total_gb":200,"disk_used_gb":41.5,"disk_partition":"anexos","availability_percent":99.9,"process_count":120,"services_running":30,"notes":"limpeza de cache"}
        ];

        // Estado da aplicação
        let metricsData = [];
        let isLoggedIn = false;
        let currentPage = 'dashboard';
        let charts = {};
        let alertHistory = [];
        let realtimeListener = null;
        let alertListener = null;
        
        // Configurações padrão
        const defaultThresholds = {
            cpu: 85,
            memory: 85,
            disk: 90,
            availability: 99
        };
        
        // ==============================================
        // FUNÇÕES DE INICIALIZAÇÃO
        // ==============================================
        
        // Inicializar a aplicação
        function initApp() {
            // Configurar data/hora atual
            updateCurrentDate();
            
            // Configurar data/hora atual no formulário
            const now = new Date();
            const timezoneOffset = now.getTimezoneOffset() * 60000;
            const localISOTime = new Date(now - timezoneOffset).toISOString().slice(0, 16);
            document.getElementById('snapshotTimestamp').value = localISOTime;
            
            // Configurar eventos
            setupEventListeners();
            
            // Tentar restaurar login do Firebase
            checkFirebaseAuthStatus();
            
            // Atualizar status de conexão
            updateConnectionStatus();
        }
        
        // Atualizar status de conexão
        function updateConnectionStatus() {
            if (navigator.onLine) {
                document.getElementById('syncStatus').textContent = 'Online';
                document.getElementById('syncStatus').className = 'sync-status sync-online';
            } else {
                document.getElementById('syncStatus').textContent = 'Offline';
                document.getElementById('syncStatus').className = 'sync-status sync-offline';
            }
        }
        
        // Atualizar status do Firebase
        function updateFirebaseStatus(message, type) {
            const statusElement = document.getElementById('firebaseStatus');
            if (statusElement) {
                statusElement.innerHTML = `<i class="fas fa-database"></i> <span>Firebase: ${message}</span>`;
                
                if (type === 'success') {
                    statusElement.style.color = 'var(--success-color)';
                } else if (type === 'danger') {
                    statusElement.style.color = 'var(--danger-color)';
                } else if (type === 'warning') {
                    statusElement.style.color = 'var(--warning-color)';
                }
            }
        }
        
        // ==============================================
        // FIREBASE - OPERAÇÕES DE DADOS
        // ==============================================
        
        // Carregar dados do Firebase
        async function loadDataFromFirebase() {
            try {
                console.log("Carregando dados do Firebase...");
                updateFirebaseStatus('Carregando dados...', 'warning');
                
                // Carregar métricas
                const metricsSnapshot = await db.collection('metrics')
                    .orderBy('timestamp', 'desc')
                    .limit(1000)
                    .get();
                
                metricsData = [];
                metricsSnapshot.forEach(doc => {
                    const data = doc.data();
                    data.id = doc.id;
                    metricsData.push(data);
                });
                
                console.log(`Dados carregados do Firebase: ${metricsData.length} registros`);
                
                // Carregar histórico de alertas
                const alertsSnapshot = await db.collection('alerts')
                    .orderBy('timestamp', 'desc')
                    .limit(500)
                    .get();
                
                alertHistory = [];
                alertsSnapshot.forEach(doc => {
                    alertHistory.push(doc.data());
                });
                
                // Carregar configurações
                const configDoc = await db.collection('config').doc('thresholds').get();
                if (configDoc.exists) {
                    const thresholds = configDoc.data();
                    document.getElementById('cpuThreshold').value = thresholds.cpu || defaultThresholds.cpu;
                    document.getElementById('memoryThreshold').value = thresholds.memory || defaultThresholds.memory;
                    document.getElementById('diskThreshold').value = thresholds.disk || defaultThresholds.disk;
                    document.getElementById('availabilityThreshold').value = thresholds.availability || defaultThresholds.availability;
                }
                
                // Atualizar dashboard
                updateDashboard();
                updateFirebaseStatus('Conectado', 'success');
                
            } catch (error) {
                console.error('Erro ao carregar dados do Firebase:', error);
                updateFirebaseStatus('Erro: ' + error.message, 'danger');
                
                // Fallback para dados locais
                loadLocalData();
            }
        }
        
        // Carregar dados locais (fallback)
        function loadLocalData() {
            console.log("Carregando dados locais...");
            
            // Carregar métricas
            const savedMetrics = localStorage.getItem('serverMetricsData');
            if (savedMetrics) {
                try {
                    metricsData = JSON.parse(savedMetrics);
                    console.log(`Dados carregados do localStorage: ${metricsData.length} registros`);
                } catch (e) {
                    console.error('Erro ao carregar dados do localStorage:', e);
                    metricsData = [...demoData];
                }
            } else {
                metricsData = [...demoData];
                console.log('Usando dados de demonstração');
            }
            
            // Carregar histórico de alertas
            const savedAlerts = localStorage.getItem('alertHistoryData');
            if (savedAlerts) {
                try {
                    alertHistory = JSON.parse(savedAlerts);
                } catch (e) {
                    console.error('Erro ao carregar histórico de alertas:', e);
                    alertHistory = [];
                }
            }
            
            // Carregar configurações
            const savedThresholds = localStorage.getItem('alertThresholds');
            if (savedThresholds) {
                try {
                    const thresholds = JSON.parse(savedThresholds);
                    document.getElementById('cpuThreshold').value = thresholds.cpu || defaultThresholds.cpu;
                    document.getElementById('memoryThreshold').value = thresholds.memory || defaultThresholds.memory;
                    document.getElementById('diskThreshold').value = thresholds.disk || defaultThresholds.disk;
                    document.getElementById('availabilityThreshold').value = thresholds.availability || defaultThresholds.availability;
                } catch (e) {
                    console.error('Erro ao carregar configurações:', e);
                }
            }
            
            // Ordenar por timestamp
            metricsData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            // Atualizar dashboard
            updateDashboard();
            updateFirebaseStatus('Modo offline (dados locais)', 'warning');
        }
        
        // Configurar listeners em tempo real
        function setupRealtimeListeners() {
            // Remover listeners anteriores
            if (realtimeListener) {
                realtimeListener();
            }
            if (alertListener) {
                alertListener();
            }
            
            // Listener para métricas
            realtimeListener = db.collection('metrics')
                .orderBy('timestamp', 'desc')
                .limit(100)
                .onSnapshot((snapshot) => {
                    const changes = snapshot.docChanges();
                    changes.forEach(change => {
                        if (change.type === 'added' || change.type === 'modified') {
                            const data = change.doc.data();
                            data.id = change.doc.id;
                            
                            const index = metricsData.findIndex(item => item.id === data.id);
                            if (index !== -1) {
                                metricsData[index] = data;
                            } else {
                                metricsData.unshift(data);
                            }
                            
                            // Manter ordenação
                            metricsData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                            
                            // Limitar tamanho
                            if (metricsData.length > 1000) {
                                metricsData = metricsData.slice(0, 1000);
                            }
                        } else if (change.type === 'removed') {
                            const id = change.doc.id;
                            metricsData = metricsData.filter(item => item.id !== id);
                        }
                    });
                    
                    // Atualizar UI
                    if (currentPage === 'dashboard') {
                        updateDashboard();
                    } else if (currentPage === 'timeline') {
                        updateTimeline();
                    } else if (currentPage === 'anexos-growth') {
                        updateAnexosGrowth();
                    }
                }, (error) => {
                    console.error('Erro no listener em tempo real:', error);
                });
            
            // Listener para alertas
            alertListener = db.collection('alerts')
                .orderBy('timestamp', 'desc')
                .limit(50)
                .onSnapshot((snapshot) => {
                    alertHistory = [];
                    snapshot.forEach(doc => {
                        alertHistory.push(doc.data());
                    });
                    
                    if (currentPage === 'alerts') {
                        updateAlerts();
                    }
                });
        }
        
        // Salvar métrica no Firebase
        async function saveMetricToFirebase(metric) {
            try {
                const metricToSave = { ...metric };
                delete metricToSave.id;
                
                // Adicionar timestamp de criação
                metricToSave.created_at = firebase.firestore.FieldValue.serverTimestamp();
                
                const docRef = await db.collection('metrics').add(metricToSave);
                console.log('Métrica salva no Firebase com ID:', docRef.id);
                
                // Verificar alertas
                checkForAlerts(metricToSave);
                
                return docRef.id;
            } catch (error) {
                console.error('Erro ao salvar métrica no Firebase:', error);
                throw error;
            }
        }
        
        // Salvar alerta no Firebase
        async function saveAlertToFirebase(alert) {
            try {
                alert.created_at = firebase.firestore.FieldValue.serverTimestamp();
                await db.collection('alerts').add(alert);
                console.log('Alerta salvo no Firebase');
            } catch (error) {
                console.error('Erro ao salvar alerta no Firebase:', error);
                // Salvar localmente como fallback
                alertHistory.unshift(alert);
                localStorage.setItem('alertHistoryData', JSON.stringify(alertHistory));
            }
        }
        
        // Salvar configurações no Firebase
        async function saveConfigToFirebase(config) {
            try {
                await db.collection('config').doc('thresholds').set(config);
                console.log('Configurações salvas no Firebase');
            } catch (error) {
                console.error('Erro ao salvar configurações no Firebase:', error);
            }
        }
        
        // Sincronizar dados locais com Firebase
        async function syncLocalDataToFirebase() {
            try {
                const localData = JSON.parse(localStorage.getItem('serverMetricsData') || '[]');
                const localAlerts = JSON.parse(localStorage.getItem('alertHistoryData') || '[]');
                
                if (localData.length === 0 && localAlerts.length === 0) {
                    alert('Nenhum dado local para sincronizar.');
                    return;
                }
                
                console.log(`Sincronizando ${localData.length} registros locais com Firebase...`);
                
                // Sincronizar métricas
                let successCount = 0;
                let errorCount = 0;
                
                for (const metric of localData) {
                    try {
                        const existingQuery = await db.collection('metrics')
                            .where('timestamp', '==', metric.timestamp)
                            .where('server', '==', metric.server)
                            .where('disk_partition', '==', metric.disk_partition)
                            .limit(1)
                            .get();
                        
                        if (existingQuery.empty) {
                            await saveMetricToFirebase(metric);
                            successCount++;
                        }
                    } catch (error) {
                        console.error('Erro ao sincronizar métrica:', error);
                        errorCount++;
                    }
                }
                
                // Sincronizar alertas
                for (const alert of localAlerts) {
                    try {
                        await saveAlertToFirebase(alert);
                    } catch (error) {
                        console.error('Erro ao sincronizar alerta:', error);
                    }
                }
                
                // Limpar dados locais após sincronização
                localStorage.removeItem('serverMetricsData');
                localStorage.removeItem('alertHistoryData');
                
                console.log('Sincronização concluída!');
                alert(`Sincronização concluída! ${successCount} registros sincronizados, ${errorCount} erros.`);
                
                // Recarregar dados do Firebase
                loadDataFromFirebase();
                
            } catch (error) {
                console.error('Erro na sincronização:', error);
                alert('Erro ao sincronizar dados: ' + error.message);
            }
        }
        
        // ==============================================
        // SISTEMA DE LOGIN
        // ==============================================
        
        // Verificar status de autenticação do Firebase
        function checkFirebaseAuthStatus() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    isLoggedIn = true;
                    showApp();
                    loadDataFromFirebase();
                    setupRealtimeListeners();
                    document.getElementById('currentUser').textContent = user.email || 'admin';
                }
            });
        }
        
        // Manipular login
        async function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === 'admin' && password === 'ZXqwas123') {
                try {
                    // Tentar autenticar com Firebase
                    await auth.signInWithEmailAndPassword('admin@esus.com', 'ZXqwas123');
                } catch (error) {
                    console.log('Tentando criar usuário...');
                    try {
                        await auth.createUserWithEmailAndPassword('admin@esus.com', 'ZXqwas123');
                        console.log('Usuário criado no Firebase');
                    } catch (createError) {
                        console.error('Erro ao criar usuário:', createError);
                        // Continuar com login local
                    }
                }
                
                isLoggedIn = true;
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('currentUser', username);
                showApp();
                loadDataFromFirebase();
                setupRealtimeListeners();
            } else {
                alert('Usuário ou senha incorretos!');
            }
        }
        
        // Manipular logout
        async function handleLogout() {
            try {
                await auth.signOut();
            } catch (error) {
                console.error('Erro ao fazer logout:', error);
            }
            
            isLoggedIn = false;
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('currentUser');
            
            // Remover listeners
            if (realtimeListener) {
                realtimeListener();
                realtimeListener = null;
            }
            if (alertListener) {
                alertListener();
                alertListener = null;
            }
            
            showLogin();
        }
        
        // Mostrar aplicação (após login)
        function showApp() {
            document.getElementById('loginPanel').classList.add('hidden');
            document.getElementById('appContainer').classList.remove('hidden');
        }
        
        // Mostrar painel de login
        function showLogin() {
            document.getElementById('loginPanel').classList.remove('hidden');
            document.getElementById('appContainer').classList.add('hidden');
        }
        
        // Mostrar painel público
        function showPublicPanel(e) {
            e.preventDefault();
            openPublicDashboard();
        }
        
        // ==============================================
        // NAVEGAÇÃO E UI
        // ==============================================
        
        // Alternar sidebar (mobile)
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
        }
        
        // Navegar para página
        function navigateToPage(pageId) {
            // Atualizar menu ativo
            document.querySelectorAll('.nav-menu a').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${pageId}`) {
                    link.classList.add('active');
                }
            });
            
            // Ocultar todas as páginas
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Mostrar página selecionada
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.remove('hidden');
                currentPage = pageId;
                
                // Atualizar conteúdo da página
                switch(pageId) {
                    case 'dashboard':
                        updateDashboard();
                        break;
                    case 'timeline':
                        updateTimeline();
                        break;
                    case 'anexos-growth':
                        updateAnexosGrowth();
                        break;
                    case 'projections':
                        updateProjections();
                        break;
                    case 'alerts':
                        updateAlerts();
                        break;
                    case 'backup':
                        updateBackupStats();
                        break;
                    case 'public-view':
                        updatePublicPreview();
                        break;
                }
            }
        }
        
        // Atualizar data atual no header
        function updateCurrentDate() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            const dateStr = now.toLocaleDateString('pt-BR', options);
            document.getElementById('currentDate').textContent = dateStr;
            document.getElementById('lastUpdateTime').textContent = `Atualizado: ${now.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}`;
        }
        
        // ==============================================
        // DASHBOARD
        // ==============================================
        
        // Atualizar dashboard completo
        function updateDashboard() {
            updateMetricsGrid();
            updateCpuChart();
            updateMemoryChart();
            updateAnexosChart();
            updateAvailabilityChart();
        }
        
        // Atualizar grid de métricas
        function updateMetricsGrid() {
            const container = document.getElementById('metricsGrid');
            if (!container) return;
            
            // Obter os dados mais recentes
            const latestData = {};
            metricsData.forEach(record => {
                const key = `${record.server}_${record.disk_partition}`;
                if (!latestData[key] || new Date(record.timestamp) > new Date(latestData[key].timestamp)) {
                    latestData[key] = record;
                }
            });
            
            // Calcular médias
            const appServerData = metricsData.filter(d => d.server === 'app-server');
            const dbServerData = metricsData.filter(d => d.server === 'db-server');
            const anexosData = metricsData.filter(d => d.disk_partition === 'anexos');
            
            const avgCpuApp = appServerData.length > 0 ? 
                appServerData.reduce((sum, r) => sum + r.cpu_percent, 0) / appServerData.length : 0;
            const avgCpuDb = dbServerData.length > 0 ? 
                dbServerData.reduce((sum, r) => sum + r.cpu_percent, 0) / dbServerData.length : 0;
            
            const avgMemoryApp = appServerData.length > 0 ? 
                appServerData.reduce((sum, r) => sum + r.memory_percent, 0) / appServerData.length : 0;
            const avgMemoryDb = dbServerData.length > 0 ? 
                dbServerData.reduce((sum, r) => sum + r.memory_percent, 0) / dbServerData.length : 0;
            
            // Calcular uso atual de anexos
            const latestAnexos = anexosData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))[0];
            const anexosUsage = latestAnexos ? latestAnexos.disk_used_gb : 0;
            const anexosTotal = latestAnexos ? latestAnexos.disk_total_gb : 200;
            const anexosPercent = latestAnexos ? (latestAnexos.disk_used_gb / latestAnexos.disk_total_gb) * 100 : 0;
            
            // Determinar status
            const thresholds = getThresholds();
            const getStatusClass = (value, threshold) => {
                if (value > threshold) return 'critical';
                if (value > threshold * 0.8) return 'warning';
                return 'success';
            };
            
            const cpuAppStatus = getStatusClass(avgCpuApp, thresholds.cpu);
            const cpuDbStatus = getStatusClass(avgCpuDb, thresholds.cpu);
            const memoryAppStatus = getStatusClass(avgMemoryApp, thresholds.memory);
            const memoryDbStatus = getStatusClass(avgMemoryDb, thresholds.memory);
            const anexosStatus = getStatusClass(anexosPercent, thresholds.disk);
            
            // Criar HTML
            container.innerHTML = `
                <div class="metric-card ${cpuAppStatus}">
                    <div class="metric-header">
                        <div class="metric-name">CPU - app-server</div>
                        <div class="status-indicator status-${cpuAppStatus}"></div>
                    </div>
                    <div class="metric-value">${avgCpuApp.toFixed(1)}%</div>
                    <div class="metric-trend ${avgCpuApp > 20 ? 'up' : 'down'}">
                        <i class="fas fa-${avgCpuApp > 20 ? 'arrow-up' : 'arrow-down'}"></i>
                        <span>Média dos últimos ${appServerData.length} registros</span>
                    </div>
                </div>
                
                <div class="metric-card ${cpuDbStatus}">
                    <div class="metric-header">
                        <div class="metric-name">CPU - db-server</div>
                        <div class="status-indicator status-${cpuDbStatus}"></div>
                    </div>
                    <div class="metric-value">${avgCpuDb.toFixed(1)}%</div>
                    <div class="metric-trend ${avgCpuDb > 25 ? 'up' : 'down'}">
                        <i class="fas fa-${avgCpuDb > 25 ? 'arrow-up' : 'arrow-down'}"></i>
                        <span>Média dos últimos ${dbServerData.length} registros</span>
                    </div>
                </div>
                
                <div class="metric-card ${memoryAppStatus}">
                    <div class="metric-header">
                        <div class="metric-name">Memória - app-server</div>
                        <div class="status-indicator status-${memoryAppStatus}"></div>
                    </div>
                    <div class="metric-value">${avgMemoryApp.toFixed(1)}%</div>
                    <div class="metric-trend ${avgMemoryApp > 50 ? 'up' : 'down'}">
                        <i class="fas fa-${avgMemoryApp > 50 ? 'arrow-up' : 'arrow-down'}"></i>
                        <span>Média dos últimos ${appServerData.length} registros</span>
                    </div>
                </div>
                
                <div class="metric-card ${memoryDbStatus}">
                    <div class="metric-header">
                        <div class="metric-name">Memória - db-server</div>
                        <div class="status-indicator status-${memoryDbStatus}"></div>
                    </div>
                    <div class="metric-value">${avgMemoryDb.toFixed(1)}%</div>
                    <div class="metric-trend ${avgMemoryDb > 60 ? 'up' : 'down'}">
                        <i class="fas fa-${avgMemoryDb > 60 ? 'arrow-up' : 'arrow-down'}"></i>
                        <span>Média dos últimos ${dbServerData.length} registros</span>
                    </div>
                </div>
                
                <div class="metric-card ${anexosStatus}">
                    <div class="metric-header">
                        <div class="metric-name">Disco - Anexos</div>
                        <div class="status-indicator status-${anexosStatus}"></div>
                    </div>
                    <div class="metric-value">${anexosUsage.toFixed(1)} GB</div>
                    <div class="metric-trend up">
                        <i class="fas fa-arrow-up"></i>
                        <span>${anexosPercent.toFixed(1)}% de ${anexosTotal} GB</span>
                    </div>
                </div>
                
                <div class="metric-card success">
                    <div class="metric-header">
                        <div class="metric-name">Total de Registros</div>
                        <div class="status-indicator status-ok"></div>
                    </div>
                    <div class="metric-value">${metricsData.length}</div>
                    <div class="metric-trend">
                        <i class="fas fa-database"></i>
                        <span>${appServerData.length} app + ${dbServerData.length} db</span>
                    </div>
                </div>
            `;
        }
        
        // Atualizar gráfico de CPU
        function updateCpuChart() {
            const ctx = document.getElementById('cpuChart');
            if (!ctx) return;
            
            const serverFilter = document.getElementById('cpuServerFilter').value;
            let filteredData = metricsData;
            
            if (serverFilter !== 'all') {
                filteredData = metricsData.filter(d => d.server === serverFilter);
            }
            
            // Agrupar por dia
            const dailyData = {};
            filteredData.forEach(record => {
                const date = new Date(record.timestamp).toISOString().split('T')[0];
                if (!dailyData[date]) {
                    dailyData[date] = {
                        date: date,
                        values: []
                    };
                }
                dailyData[date].values.push(record.cpu_percent);
            });
            
            // Calcular média por dia
            const dates = Object.keys(dailyData).sort();
            const averages = dates.map(date => {
                const values = dailyData[date].values;
                return values.reduce((a, b) => a + b, 0) / values.length;
            });
            
            // Destruir gráfico existente
            if (charts.cpuChart) {
                charts.cpuChart.destroy();
            }
            
            // Criar novo gráfico
            charts.cpuChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'CPU %',
                        data: averages,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `CPU: ${context.parsed.y.toFixed(1)}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Data'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'CPU %'
                            }
                        }
                    }
                }
            });
        }
        
        // Atualizar gráfico de memória
        function updateMemoryChart() {
            const ctx = document.getElementById('memoryChart');
            if (!ctx) return;
            
            const serverFilter = document.getElementById('memoryServerFilter').value;
            let filteredData = metricsData;
            
            if (serverFilter !== 'all') {
                filteredData = metricsData.filter(d => d.server === serverFilter);
            }
            
            // Agrupar por dia
            const dailyData = {};
            filteredData.forEach(record => {
                const date = new Date(record.timestamp).toISOString().split('T')[0];
                if (!dailyData[date]) {
                    dailyData[date] = {
                        date: date,
                        values: []
                    };
                }
                dailyData[date].values.push(record.memory_percent);
            });
            
            // Calcular média por dia
            const dates = Object.keys(dailyData).sort();
            const averages = dates.map(date => {
                const values = dailyData[date].values;
                return values.reduce((a, b) => a + b, 0) / values.length;
            });
            
            // Destruir gráfico existente
            if (charts.memoryChart) {
                charts.memoryChart.destroy();
            }
            
            // Criar novo gráfico
            charts.memoryChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Memória %',
                        data: averages,
                        borderColor: '#2ecc71',
                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Memória: ${context.parsed.y.toFixed(1)}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Data'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Memória %'
                            }
                        }
                    }
                }
            });
        }
        
        // Atualizar gráfico de anexos
        function updateAnexosChart() {
            const ctx = document.getElementById('anexosChart');
            if (!ctx) return;
            
            // Filtrar dados da partição "anexos" do app-server
            const anexosData = metricsData.filter(d => 
                d.server === 'app-server' && d.disk_partition === 'anexos'
            ).sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            
            // Extrair datas e valores
            const dates = anexosData.map(d => new Date(d.timestamp).toISOString().split('T')[0]);
            const values = anexosData.map(d => d.disk_used_gb);
            
            // Destruir gráfico existente
            if (charts.anexosChart) {
                charts.anexosChart.destroy();
            }
            
            // Criar novo gráfico
            charts.anexosChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Uso de Disco (GB)',
                        data: values,
                        borderColor: '#9b59b6',
                        backgroundColor: 'rgba(155, 89, 182, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const record = anexosData[context.dataIndex];
                                    const percent = (record.disk_used_gb / record.disk_total_gb) * 100;
                                    return `${record.disk_used_gb.toFixed(1)} GB (${percent.toFixed(1)}%)`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Data'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Uso de Disco (GB)'
                            }
                        }
                    }
                }
            });
        }
        
        // Atualizar gráfico de disponibilidade
        function updateAvailabilityChart() {
            const ctx = document.getElementById('availabilityChart');
            if (!ctx) return;
            
            // Agrupar por servidor
            const serverData = {
                'app-server': metricsData.filter(d => d.server === 'app-server'),
                'db-server': metricsData.filter(d => d.server === 'db-server')
            };
            
            // Calcular média de disponibilidade por dia para cada servidor
            const dates = [...new Set(metricsData.map(d => new Date(d.timestamp).toISOString().split('T')[0]))].sort();
            
            const appServerAverages = dates.map(date => {
                const dayData = serverData['app-server'].filter(d => 
                    new Date(d.timestamp).toISOString().split('T')[0] === date
                );
                if (dayData.length === 0) return null;
                return dayData.reduce((sum, r) => sum + r.availability_percent, 0) / dayData.length;
            });
            
            const dbServerAverages = dates.map(date => {
                const dayData = serverData['db-server'].filter(d => 
                    new Date(d.timestamp).toISOString().split('T')[0] === date
                );
                if (dayData.length === 0) return null;
                return dayData.reduce((sum, r) => sum + r.availability_percent, 0) / dayData.length;
            });
            
            // Destruir gráfico existente
            if (charts.availabilityChart) {
                charts.availabilityChart.destroy();
            }
            
            // Criar novo gráfico
            charts.availabilityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [
                        {
                            label: 'app-server',
                            data: appServerAverages,
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'db-server',
                            data: dbServerAverages,
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.y.toFixed(2)}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Data'
                            }
                        },
                        y: {
                            min: 98,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Disponibilidade %'
                            }
                        }
                    }
                }
            });
        }
        
        // ==============================================
        // TIMELINE
        // ==============================================
        
        // Atualizar timeline
        function updateTimeline() {
            const container = document.getElementById('timelineContainer');
            if (!container) return;
            
            const serverFilter = document.getElementById('timelineServerFilter').value;
            const periodFilter = parseInt(document.getElementById('timelinePeriodFilter').value);
            const sortFilter = document.getElementById('timelineSortFilter').value;
            
            // Filtrar dados
            let filteredData = [...metricsData];
            
            if (serverFilter !== 'all') {
                filteredData = filteredData.filter(d => d.server === serverFilter);
            }
            
            // Filtrar por período
            const cutoffDate = new Date();
            cutoffDate.setDate(cutoffDate.getDate() - periodFilter);
            filteredData = filteredData.filter(d => new Date(d.timestamp) >= cutoffDate);
            
            // Ordenar
            if (sortFilter === 'date-asc') {
                filteredData.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            } else {
                filteredData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            }
            
            // Limitar a 50 eventos
            filteredData = filteredData.slice(0, 50);
            
            // Gerar HTML da timeline
            let timelineHTML = '';
            
            filteredData.forEach(record => {
                const date = new Date(record.timestamp);
                const dateStr = date.toLocaleDateString('pt-BR');
                const timeStr = date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                const dayOfWeek = date.toLocaleDateString('pt-BR', { weekday: 'long' });
                
                // Determinar ícone
                let icon = 'fa-server';
                let color = '#3498db';
                
                if (record.cpu_percent > 80) {
                    icon = 'fa-microchip';
                    color = '#e74c3c';
                } else if (record.disk_partition === 'anexos') {
                    icon = 'fa-hdd';
                    color = '#9b59b6';
                } else if (record.availability_percent < 99) {
                    icon = 'fa-exclamation-triangle';
                    color = '#f39c12';
                }
                
                // Calcular percentual de disco
                const diskPercent = (record.disk_used_gb / record.disk_total_gb) * 100;
                
                timelineHTML += `
                    <div class="timeline-item">
                        <div class="timeline-date">
                            <i class="fas ${icon}" style="color: ${color};"></i>
                            <strong>${dateStr}</strong> - ${timeStr} (${dayOfWeek})
                            <span class="badge ${record.server === 'app-server' ? 'badge-success' : 'badge-warning'}">
                                ${record.server}
                            </span>
                        </div>
                        <div class="timeline-content">
                            <div class="flex justify-between">
                                <div>
                                    <strong>CPU:</strong> ${record.cpu_percent.toFixed(1)}% |
                                    <strong>Memória:</strong> ${record.memory_percent.toFixed(1)}% |
                                    <strong>Disco (${record.disk_partition}):</strong> ${record.disk_used_gb.toFixed(1)} GB (${diskPercent.toFixed(1)}%)
                                </div>
                                <div>
                                    <strong>Disponibilidade:</strong> ${record.availability_percent.toFixed(1)}%
                                </div>
                            </div>
                            ${record.notes ? `<div class="mt-10"><strong>Notas:</strong> ${record.notes}</div>` : ''}
                        </div>
                    </div>
                `;
            });
            
            if (filteredData.length === 0) {
                timelineHTML = '<p class="text-center">Nenhum evento encontrado no período selecionado.</p>';
            }
            
            container.innerHTML = timelineHTML;
        }
        
        // ==============================================
        // CRESCIMENTO ANEXOS
        // ==============================================
        
        // Atualizar seção de crescimento dos anexos
        function updateAnexosGrowth() {
            updateAnexosSummary();
            updateAnexosGrowthChart();
            updateGrowthRateChart();
            updateAnexosHistoryTable();
            calculateAnexosProjections();
        }
        
        // Atualizar resumo dos anexos
        function updateAnexosSummary() {
            const container = document.getElementById('anexosSummary');
            if (!container) return;
            
            // Filtrar dados da partição "anexos" do app-server
            const anexosData = metricsData.filter(d => 
                d.server === 'app-server' && d.disk_partition === 'anexos'
            ).sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            
            if (anexosData.length === 0) {
                container.innerHTML = '<p>Nenhum dado disponível para a unidade "anexos".</p>';
                return;
            }
            
            const firstRecord = anexosData[0];
            const lastRecord = anexosData[anexosData.length - 1];
            
            // Calcular crescimento total
            const totalGrowth = lastRecord.disk_used_gb - firstRecord.disk_used_gb;
            const totalDays = Math.ceil((new Date(lastRecord.timestamp) - new Date(firstRecord.timestamp)) / (1000 * 60 * 60 * 24));
            const avgDailyGrowth = totalGrowth / totalDays;
            
            // Calcular dias até 90% de uso
            const diskTotal = lastRecord.disk_total_gb;
            const currentUsage = lastRecord.disk_used_gb;
            const currentPercent = (currentUsage / diskTotal) * 100;
            const daysTo90 = avgDailyGrowth > 0 ? 
                Math.max(0, ((diskTotal * 0.9) - currentUsage) / avgDailyGrowth) : 
                Infinity;
            
            // Calcular data estimada para 90%
            let estimatedDate = 'N/A';
            if (daysTo90 !== Infinity && daysTo90 > 0) {
                const date = new Date(lastRecord.timestamp);
                date.setDate(date.getDate() + daysTo90);
                estimatedDate = date.toLocaleDateString('pt-BR');
            }
            
            // Atualizar métricas
            document.getElementById('currentAnexosUsage').textContent = `${currentUsage.toFixed(1)} GB`;
            document.getElementById('avgDailyGrowth').textContent = `${avgDailyGrowth.toFixed(2)}`;
            document.getElementById('daysTo90Percent').textContent = daysTo90 === Infinity ? '∞' : Math.floor(daysTo90);
            document.getElementById('estimated90Date').textContent = estimatedDate;
            
            // Atualizar tendência
            const trendElement = document.getElementById('anexosTrend');
            if (avgDailyGrowth > 1) {
                trendElement.innerHTML = `<i class="fas fa-arrow-up"></i> Alto crescimento`;
                trendElement.className = 'metric-trend up';
            } else if (avgDailyGrowth > 0.1) {
                trendElement.innerHTML = `<i class="fas fa-arrow-up"></i> Crescimento moderado`;
                trendElement.className = 'metric-trend up';
            } else {
                trendElement.innerHTML = `<i class="fas fa-arrow-down"></i> Crescimento baixo`;
                trendElement.className = 'metric-trend down';
            }
            
            // Atualizar resumo
            container.innerHTML = `
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-name">Período Monitorado</div>
                        <div class="metric-value">${totalDays} dias</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-name">Crescimento Total</div>
                        <div class="metric-value">${totalGrowth.toFixed(1)} GB</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-name">Uso Atual</div>
                        <div class="metric-value">${currentPercent.toFixed(1)}%</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-name">Espaço Disponível</div>
                        <div class="metric-value">${(diskTotal - currentUsage).toFixed(1)} GB</div>
                    </div>
                </div>
            `;
        }
        
        // Atualizar gráfico de crescimento dos anexos
        function updateAnexosGrowthChart() {
            const ctx = document.getElementById('anexosGrowthChart');
            if (!ctx) return;
            
            // Filtrar dados da partição "anexos" do app-server
            const anexosData = metricsData.filter(d => 
                d.server === 'app-server' && d.disk_partition === 'anexos'
            ).sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            
            if (anexosData.length === 0) return;
            
            // Extrair datas e valores
            const dates = anexosData.map(d => {
                const date = new Date(d.timestamp);
                return `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth()+1).toString().padStart(2, '0')}`;
            });
            const values = anexosData.map(d => d.disk_used_gb);
            
            // Calcular crescimento diário
            const dailyGrowth = [];
            for (let i = 1; i < values.length; i++) {
                dailyGrowth.push(values[i] - values[i-1]);
            }
            
            // Destruir gráfico existente
            if (charts.anexosGrowthChart) {
                charts.anexosGrowthChart.destroy();
            }
            
            // Criar novo gráfico
            charts.anexosGrowthChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dates.slice(1),
                    datasets: [
                        {
                            label: 'Uso de Disco (GB)',
                            data: values.slice(1),
                            type: 'line',
                            borderColor: '#9b59b6',
                            backgroundColor: 'rgba(155, 89, 182, 0.1)',
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Crescimento Diário (GB)',
                            data: dailyGrowth,
                            backgroundColor: 'rgba(52, 152, 219, 0.5)',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    if (context.datasetIndex === 0) {
                                        return `Uso: ${context.parsed.y.toFixed(1)} GB`;
                                    } else {
                                        return `Crescimento: ${context.parsed.y.toFixed(2)} GB`;
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Data'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Uso de Disco (GB)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Crescimento Diário (GB)'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });
        }
        
        // Atualizar gráfico de taxa de crescimento
        function updateGrowthRateChart() {
            const ctx = document.getElementById('growthRateChart');
            if (!ctx) return;
            
            // Filtrar dados da partição "anexos" do app-server
            const anexosData = metricsData.filter(d => 
                d.server === 'app-server' && d.disk_partition === 'anexos'
            ).sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            
            if (anexosData.length < 2) return;
            
            // Calcular taxa de crescimento percentual diária
            const dates = [];
            const growthRates = [];
            
            for (let i = 1; i < anexosData.length; i++) {
                const prev = anexosData[i-1];
                const curr = anexosData[i];
                
                const date = new Date(curr.timestamp);
                dates.push(`${date.getDate().toString().padStart(2, '0')}/${(date.getMonth()+1).toString().padStart(2, '0')}`);
                
                const growth = curr.disk_used_gb - prev.disk_used_gb;
                const growthRate = (growth / prev.disk_used_gb) * 100;
                growthRates.push(growthRate);
            }
            
            // Destruir gráfico existente
            if (charts.growthRateChart) {
                charts.growthRateChart.destroy();
            }
            
            // Criar novo gráfico
            charts.growthRateChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Taxa de Crescimento Diária (%)',
                        data: growthRates,
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Taxa: ${context.parsed.y.toFixed(2)}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Data'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Taxa de Crescimento (%)'
                            }
                        }
                    }
                }
            });
        }
        
        // Atualizar tabela de histórico dos anexos
        function updateAnexosHistoryTable() {
            const container = document.getElementById('anexosHistoryTable');
            if (!container) return;
            
            // Filtrar dados da partição "anexos" do app-server
            const anexosData = metricsData.filter(d => 
                d.server === 'app-server' && d.disk_partition === 'anexos'
            ).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            let tableHTML = '';
            
            if (anexosData.length === 0) {
                tableHTML = '<tr><td colspan="6" class="text-center">Nenhum dado disponível</td></tr>';
            } else {
                // Calcular crescimento entre registros
                for (let i = 0; i < Math.min(anexosData.length, 20); i++) {
                    const record = anexosData[i];
                    const date = new Date(record.timestamp);
                    const dateStr = date.toLocaleDateString('pt-BR');
                    const dayOfWeek = date.toLocaleDateString('pt-BR', { weekday: 'short' });
                    
                    // Calcular crescimento desde o registro anterior
                    let dailyGrowth = 'N/A';
                    if (i < anexosData.length - 1) {
                        const prevRecord = anexosData[i+1];
                        const growth = record.disk_used_gb - prevRecord.disk_used_gb;
                        const daysDiff = (new Date(record.timestamp) - new Date(prevRecord.timestamp)) / (1000 * 60 * 60 * 24);
                        
                        if (daysDiff > 0) {
                            dailyGrowth = `${growth.toFixed(2)} GB`;
                        }
                    }
                    
                    const diskPercent = (record.disk_used_gb / record.disk_total_gb) * 100;
                    
                    tableHTML += `
                        <tr>
                            <td>${dateStr}</td>
                            <td>${dayOfWeek}</td>
                            <td>${record.disk_used_gb.toFixed(1)}</td>
                            <td>${dailyGrowth}</td>
                            <td>${diskPercent.toFixed(1)}%</td>
                            <td>${record.availability_percent.toFixed(1)}%</td>
                        </tr>
                    `;
                }
            }
            
            container.innerHTML = tableHTML;
        }
        
        // Calcular projeções dos anexos
        function calculateAnexosProjections() {
            // Filtrar dados da partição "anexos" do app-server
            const anexosData = metricsData.filter(d => 
                d.server === 'app-server' && d.disk_partition === 'anexos'
            ).sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            
            if (anexosData.length < 2) return;
            
            // Calcular regressão linear
            const regression = calculateLinearRegression(anexosData);
            
            // Calcular projeções
            const lastDate = new Date(anexosData[anexosData.length - 1].timestamp);
            const diskTotal = anexosData[0].disk_total_gb;
            
            // Projeção para 30 dias
            const projection30 = regression.slope * 30 + regression.intercept;
            const projection30Percent = (projection30 / diskTotal) * 100;
            
            // Projeção para 90 dias
            const projection90 = regression.slope * 90 + regression.intercept;
            const projection90Percent = (projection90 / diskTotal) * 100;
            
            // Projeção para 180 dias
            const projection180 = regression.slope * 180 + regression.intercept;
            const projection180Percent = (projection180 / diskTotal) * 100;
            
            // Projeção para 365 dias (1 ano)
            const projection365 = regression.slope * 365 + regression.intercept;
            const projection365Percent = (projection365 / diskTotal) * 100;
            
            // Atualizar elementos da UI
            document.getElementById('projection30Days').textContent = `${projection30.toFixed(1)} GB`;
            document.getElementById('projection90Days').textContent = `${projection90.toFixed(1)} GB`;
            document.getElementById('projection180Days').textContent = `${projection180.toFixed(1)} GB`;
            document.getElementById('projection365Days').textContent = `${projection365.toFixed(1)} GB`;
            
            // Atualizar tendências
            updateProjectionTrend('projection30Trend', projection30Percent);
            updateProjectionTrend('projection90Trend', projection90Percent);
            updateProjectionTrend('projection180Trend', projection180Percent);
            updateProjectionTrend('projection365Trend', projection365Percent);
            
            // Atualizar tabela de estatísticas de projeção
            updateProjectionStatsTable(regression, lastDate, diskTotal);
        }
        
        // Atualizar tendência da projeção
        function updateProjectionTrend(elementId, percent) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const thresholds = getThresholds();
            
            if (percent > thresholds.disk) {
                element.innerHTML = `<i class="fas fa-exclamation-circle"></i> Crítico (${percent.toFixed(1)}%)`;
                element.className = 'metric-trend up';
            } else if (percent > thresholds.disk * 0.8) {
                element.innerHTML = `<i class="fas fa-exclamation-triangle"></i> Alerta (${percent.toFixed(1)}%)`;
                element.className = 'metric-trend up';
            } else {
                element.innerHTML = `<i class="fas fa-check-circle"></i> Normal (${percent.toFixed(1)}%)`;
                element.className = 'metric-trend down';
            }
        }
        
        // Atualizar tabela de estatísticas de projeção
        function updateProjectionStatsTable(regression, lastDate, diskTotal) {
            const container = document.getElementById('projectionStatsTable');
            if (!container) return;
            
            const periods = [30, 90, 180, 365];
            let tableHTML = '';
            
            periods.forEach(days => {
                const projection = regression.slope * days + regression.intercept;
                const percent = (projection / diskTotal) * 100;
                
                // Calcular data estimada
                const estimatedDate = new Date(lastDate);
                estimatedDate.setDate(estimatedDate.getDate() + days);
                const dateStr = estimatedDate.toLocaleDateString('pt-BR');
                
                // Calcular crescimento total
                const currentUsage = regression.intercept;
                const totalGrowth = projection - currentUsage;
                
                // Determinar status
                let status = 'Normal';
                let statusClass = 'badge-success';
                
                const thresholds = getThresholds();
                if (percent > thresholds.disk) {
                    status = 'Crítico';
                    statusClass = 'badge-danger';
                } else if (percent > thresholds.disk * 0.8) {
                    status = 'Alerta';
                    statusClass = 'badge-warning';
                }
                
                tableHTML += `
                    <tr>
                        <td>${days} dias</td>
                        <td>${projection.toFixed(1)} GB</td>
                        <td>${percent.toFixed(1)}%</td>
                        <td>${totalGrowth.toFixed(1)} GB</td>
                        <td>${dateStr}</td>
                        <td><span class="badge ${statusClass}">${status}</span></td>
                    </tr>
                `;
            });
            
            container.innerHTML = tableHTML;
        }
        
        // ==============================================
        // PROJEÇÕES ANUAIS
        // ==============================================
        
        // Atualizar seção de projeções
        function updateProjections() {
            updateAnnualProjectionChart();
            calculateAnexosProjections();
        }
        
        // Atualizar gráfico de projeção anual
        function updateAnnualProjectionChart() {
            const ctx = document.getElementById('annualProjectionChart');
            if (!ctx) return;
            
            // Filtrar dados da partição "anexos" do app-server
            const anexosData = metricsData.filter(d => 
                d.server === 'app-server' && d.disk_partition === 'anexos'
            ).sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            
            if (anexosData.length < 2) return;
            
            // Calcular regressão linear
            const regression = calculateLinearRegression(anexosData);
            
            // Obter período de projeção
            const projectionPeriod = parseInt(document.getElementById('projectionPeriod').value);
            
            // Preparar dados históricos
            const historicalDates = anexosData.map(d => new Date(d.timestamp));
            const historicalValues = anexosData.map(d => d.disk_used_gb);
            
            // Preparar dados de projeção
            const lastDate = new Date(anexosData[anexosData.length - 1].timestamp);
            const projectionDates = [];
            const projectionValues = [];
            
            // Adicionar ponto de início (último registro)
            projectionDates.push(lastDate);
            projectionValues.push(historicalValues[historicalValues.length - 1]);
            
            // Adicionar pontos de projeção
            for (let i = 30; i <= projectionPeriod; i += 30) {
                const date = new Date(lastDate);
                date.setDate(date.getDate() + i);
                projectionDates.push(date);
                
                const value = regression.slope * i + regression.intercept;
                projectionValues.push(value);
            }
            
            // Destruir gráfico existente
            if (charts.annualProjectionChart) {
                charts.annualProjectionChart.destroy();
            }
            
            // Criar novo gráfico
            charts.annualProjectionChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'Dados Históricos',
                            data: historicalValues.map((value, index) => ({
                                x: historicalDates[index],
                                y: value
                            })),
                            borderColor: '#9b59b6',
                            backgroundColor: 'rgba(155, 89, 182, 0.1)',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Projeção Linear',
                            data: projectionValues.map((value, index) => ({
                                x: projectionDates[index],
                                y: value
                            })),
                            borderColor: '#e74c3c',
                            borderDash: [5, 5],
                            backgroundColor: 'transparent',
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.y.toFixed(1)} GB`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'month',
                                displayFormats: {
                                    month: 'MMM yyyy'
                                }
                            },
                            title: {
                                display: true,
                                text: 'Data'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Uso de Disco (GB)'
                            }
                        }
                    }
                }
            });
        }
        
        // ==============================================
        // FORMULÁRIO DE SNAPSHOT
        // ==============================================
        
        // Adicionar snapshot
        async function addSnapshot() {
            // Validar formulário
            const server = document.getElementById('snapshotServer').value;
            const partition = document.getElementById('snapshotPartition').value;
            const timestamp = document.getElementById('snapshotTimestamp').value;
            const cpu = parseFloat(document.getElementById('snapshotCpu').value);
            const memory = parseFloat(document.getElementById('snapshotMemory').value);
            const diskTotal = parseFloat(document.getElementById('snapshotDiskTotal').value);
            const diskUsed = parseFloat(document.getElementById('snapshotDiskUsed').value);
            const availability = parseFloat(document.getElementById('snapshotAvailability').value);
            const processCount = parseInt(document.getElementById('snapshotProcessCount').value);
            const servicesRunning = parseInt(document.getElementById('snapshotServices').value);
            const notes = document.getElementById('snapshotNotes').value;
            
            // Validações
            if (!timestamp) {
                alert('Por favor, preencha a data/hora');
                return;
            }
            
            if (isNaN(cpu) || cpu < 0 || cpu > 100) {
                alert('CPU deve ser um número entre 0 e 100');
                return;
            }
            
            if (isNaN(memory) || memory < 0 || memory > 100) {
                alert('Memória deve ser um número entre 0 e 100');
                return;
            }
            
            if (isNaN(diskTotal) || diskTotal <= 0) {
                alert('Disco Total deve ser um número maior que 0');
                return;
            }
            
            if (isNaN(diskUsed) || diskUsed < 0 || diskUsed > diskTotal) {
                alert('Disco Usado deve ser um número entre 0 e Disco Total');
                return;
            }
            
            if (isNaN(availability) || availability < 0 || availability > 100) {
                alert('Disponibilidade deve ser um número entre 0 e 100');
                return;
            }
            
            // Converter timestamp para ISO 8601
            const isoTimestamp = new Date(timestamp).toISOString();
            
            // Criar objeto de métrica
            const metric = {
                timestamp: isoTimestamp,
                server: server,
                cpu_percent: cpu,
                memory_percent: memory,
                disk_total_gb: diskTotal,
                disk_used_gb: diskUsed,
                disk_partition: partition,
                availability_percent: availability,
                process_count: processCount,
                services_running: servicesRunning,
                notes: notes
            };
            
            try {
                // Salvar no Firebase
                await saveMetricToFirebase(metric);
                
                // Adicionar ao array local também
                metricsData.unshift(metric);
                
                // Manter ordenação
                metricsData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                // Salvar backup local
                localStorage.setItem('serverMetricsData', JSON.stringify(metricsData));
                
                // Atualizar dashboard
                updateDashboard();
                
                // Se estiver na página de crescimento dos anexos, atualizá-la
                if (currentPage === 'anexos-growth') {
                    updateAnexosGrowth();
                }
                
                // Se estiver na página de projeções, atualizá-la
                if (currentPage === 'projections') {
                    updateProjections();
                }
                
                // Limpar formulário
                clearForm();
                
                // Mostrar confirmação
                alert('Snapshot salvo no Firebase com sucesso!');
                
            } catch (error) {
                console.error('Erro ao salvar snapshot:', error);
                alert('Erro ao salvar no Firebase. Salvando localmente...');
                
                // Fallback: salvar localmente
                metric.id = 'local_' + Date.now();
                metricsData.unshift(metric);
                localStorage.setItem('serverMetricsData', JSON.stringify(metricsData));
                alert('Snapshot salvo localmente (backup).');
            }
        }
        
        // Limpar formulário
        function clearForm() {
            document.getElementById('snapshotCpu').value = '';
            document.getElementById('snapshotMemory').value = '';
            document.getElementById('snapshotDiskTotal').value = '';
            document.getElementById('snapshotDiskUsed').value = '';
            document.getElementById('snapshotAvailability').value = '';
            document.getElementById('snapshotProcessCount').value = '';
            document.getElementById('snapshotServices').value = '';
            document.getElementById('snapshotNotes').value = '';
            
            // Configurar data/hora atual
            const now = new Date();
            const timezoneOffset = now.getTimezoneOffset() * 60000;
            const localISOTime = new Date(now - timezoneOffset).toISOString().slice(0, 16);
            document.getElementById('snapshotTimestamp').value = localISOTime;
        }
        
        // ==============================================
        // ALERTAS
        // ==============================================
        
        // Atualizar seção de alertas
        function updateAlerts() {
            updateActiveAlerts();
            updateAlertsHistoryTable();
        }
        
        // Obter limiares
        function getThresholds() {
            return {
                cpu: parseInt(document.getElementById('cpuThreshold').value) || defaultThresholds.cpu,
                memory: parseInt(document.getElementById('memoryThreshold').value) || defaultThresholds.memory,
                disk: parseInt(document.getElementById('diskThreshold').value) || defaultThresholds.disk,
                availability: parseInt(document.getElementById('availabilityThreshold').value) || defaultThresholds.availability
            };
        }
        
        // Salvar limiares
        async function saveThresholds() {
            const thresholds = getThresholds();
            
            try {
                // Salvar no Firebase
                await saveConfigToFirebase(thresholds);
                
                // Salvar localmente também
                localStorage.setItem('alertThresholds', JSON.stringify(thresholds));
                
                // Verificar alertas para todos os registros
                metricsData.forEach(record => {
                    checkForAlerts(record);
                });
                
                // Atualizar dashboard
                updateDashboard();
                
                alert('Limiares salvos no Firebase!');
                
            } catch (error) {
                console.error('Erro ao salvar limiares:', error);
                // Fallback: salvar localmente
                localStorage.setItem('alertThresholds', JSON.stringify(thresholds));
                alert('Limiares salvos localmente (backup).');
            }
        }
        
        // Verificar alertas para um registro
        async function checkForAlerts(record) {
            const thresholds = getThresholds();
            const now = new Date();
            
            // Verificar CPU
            if (record.cpu_percent > thresholds.cpu) {
                const alert = {
                    timestamp: now.toISOString(),
                    server: record.server,
                    type: 'CPU',
                    metric: 'cpu_percent',
                    value: record.cpu_percent,
                    threshold: thresholds.cpu,
                    status: 'critical',
                    created_at: now.toISOString()
                };
                
                await saveAlertToFirebase(alert);
            }
            
            // Verificar Memória
            if (record.memory_percent > thresholds.memory) {
                const alert = {
                    timestamp: now.toISOString(),
                    server: record.server,
                    type: 'Memória',
                    metric: 'memory_percent',
                    value: record.memory_percent,
                    threshold: thresholds.memory,
                    status: 'critical',
                    created_at: now.toISOString()
                };
                
                await saveAlertToFirebase(alert);
            }
            
            // Verificar Disco
            const diskPercent = (record.disk_used_gb / record.disk_total_gb) * 100;
            if (diskPercent > thresholds.disk) {
                const alert = {
                    timestamp: now.toISOString(),
                    server: record.server,
                    type: 'Disco',
                    metric: 'disk_used_gb',
                    value: diskPercent,
                    threshold: thresholds.disk,
                    status: 'critical',
                    created_at: now.toISOString()
                };
                
                await saveAlertToFirebase(alert);
            }
            
            // Verificar Disponibilidade
            if (record.availability_percent < thresholds.availability) {
                const alert = {
                    timestamp: now.toISOString(),
                    server: record.server,
                    type: 'Disponibilidade',
                    metric: 'availability_percent',
                    value: record.availability_percent,
                    threshold: thresholds.availability,
                    status: 'warning',
                    created_at: now.toISOString()
                };
                
                await saveAlertToFirebase(alert);
            }
        }
        
        // Atualizar alertas ativos
        function updateActiveAlerts() {
            const container = document.getElementById('activeAlertsContainer');
            if (!container) return;
            
            // Filtrar alertas das últimas 24 horas
            const twentyFourHoursAgo = new Date();
            twentyFourHoursAgo.setHours(twentyFourHoursAgo.getHours() - 24);
            
            const recentAlerts = alertHistory.filter(a => 
                new Date(a.timestamp) > twentyFourHoursAgo
            );
            
            let alertsHTML = '';
            
            if (recentAlerts.length === 0) {
                alertsHTML = '<div class="alert alert-info">Nenhum alerta ativo nas últimas 24 horas.</div>';
            } else {
                // Agrupar por tipo e servidor
                const groupedAlerts = {};
                recentAlerts.forEach(alert => {
                    const key = `${alert.server}_${alert.type}`;
                    if (!groupedAlerts[key]) {
                        groupedAlerts[key] = {
                            server: alert.server,
                            type: alert.type,
                            count: 0,
                            latest: alert,
                            status: alert.status
                        };
                    }
                    groupedAlerts[key].count++;
                });
                
                // Criar HTML para cada grupo
                Object.values(groupedAlerts).forEach(group => {
                    const timeStr = new Date(group.latest.timestamp).toLocaleTimeString('pt-BR', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    
                    const alertClass = group.status === 'critical' ? 'alert-critical' : 'alert-warning';
                    
                    alertsHTML += `
                        <div class="alert ${alertClass}">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div>
                                <strong>${group.type} - ${group.server}</strong><br>
                                ${group.count} alerta(s) - Último: ${timeStr}<br>
                                Valor: ${group.latest.value.toFixed(1)}% | Limiar: ${group.latest.threshold}%
                            </div>
                        </div>
                    `;
                });
            }
            
            container.innerHTML = alertsHTML;
        }
        
        // Atualizar tabela de histórico de alertas
        function updateAlertsHistoryTable() {
            const container = document.getElementById('alertsHistoryTable');
            if (!container) return;
            
            // Limitar a 50 alertas
            const recentAlerts = alertHistory.slice(0, 50);
            
            let tableHTML = '';
            
            if (recentAlerts.length === 0) {
                tableHTML = '<tr><td colspan="7" class="text-center">Nenhum alerta registrado</td></tr>';
            } else {
                recentAlerts.forEach(alert => {
                    const date = new Date(alert.timestamp);
                    const dateStr = date.toLocaleDateString('pt-BR');
                    const timeStr = date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                    
                    const statusClass = alert.status === 'critical' ? 'badge-danger' : 'badge-warning';
                    
                    tableHTML += `
                        <tr>
                            <td>${dateStr} ${timeStr}</td>
                            <td>${alert.server}</td>
                            <td>${alert.type}</td>
                            <td>${alert.metric}</td>
                            <td>${alert.value.toFixed(1)}%</td>
                            <td>${alert.threshold}%</td>
                            <td><span class="badge ${statusClass}">${alert.status === 'critical' ? 'Crítico' : 'Aviso'}</span></td>
                        </tr>
                    `;
                });
            }
            
            container.innerHTML = tableHTML;
        }
        
        // ==============================================
        // BACKUP E RESTAURAÇÃO
        // ==============================================
        
        // Atualizar estatísticas de backup
        function updateBackupStats() {
            // Total de registros
            document.getElementById('totalRecords').textContent = metricsData.length;
            
            // Primeiro e último registro
            if (metricsData.length > 0) {
                const firstRecord = metricsData[metricsData.length - 1];
                const lastRecord = metricsData[0];
                
                const firstDate = new Date(firstRecord.timestamp);
                const lastDate = new Date(lastRecord.timestamp);
                
                document.getElementById('firstRecordDate').textContent = firstDate.toLocaleDateString('pt-BR');
                document.getElementById('lastRecordDate').textContent = lastDate.toLocaleDateString('pt-BR');
                
                // Calcular tendência
                const recordsTrend = document.getElementById('recordsTrend');
                const daysDiff = (lastDate - firstDate) / (1000 * 60 * 60 * 24);
                const recordsPerDay = metricsData.length / Math.max(daysDiff, 1);
                
                recordsTrend.innerHTML = `${recordsPerDay.toFixed(1)} registros/dia`;
            }
            
            // Tamanho dos dados
            const dataSize = JSON.stringify(metricsData).length / 1024;
            document.getElementById('dataSize').textContent = dataSize.toFixed(1);
        }
        
        // Exportar todos os dados
        async function exportAllData() {
            try {
                // Tentar obter dados do Firebase primeiro
                let dataToExport = [];
                
                if (navigator.onLine) {
                    // Buscar todos os dados do Firebase
                    const snapshot = await db.collection('metrics').get();
                    snapshot.forEach(doc => {
                        dataToExport.push(doc.data());
                    });
                    
                    console.log(`Exportando ${dataToExport.length} registros do Firebase`);
                } else {
                    // Fallback para dados locais
                    dataToExport = [...metricsData];
                    console.log(`Exportando ${dataToExport.length} registros locais`);
                }
                
                if (dataToExport.length === 0) {
                    alert('Não há dados para exportar');
                    return;
                }
                
                const exportFormat = document.getElementById('exportFormat').value;
                const dateRange = document.getElementById('exportDateRange').value;
                
                // Filtrar por intervalo de datas
                if (dateRange !== 'all') {
                    const cutoffDate = new Date();
                    cutoffDate.setDate(cutoffDate.getDate() - parseInt(dateRange));
                    dataToExport = dataToExport.filter(d => new Date(d.timestamp) >= cutoffDate);
                }
                
                if (dataToExport.length === 0) {
                    alert('Nenhum dado encontrado no intervalo selecionado');
                    return;
                }
                
                // Ordenar por data (mais antigo primeiro para exportação)
                dataToExport.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                
                let dataStr, filename, mimeType;
                
                if (exportFormat === 'csv') {
                    // Converter para CSV
                    const headers = ['timestamp', 'server', 'cpu_percent', 'memory_percent', 'disk_total_gb', 'disk_used_gb', 'disk_partition', 'availability_percent', 'process_count', 'services_running', 'notes'];
                    const csvRows = [headers.join(',')];
                    
                    dataToExport.forEach(record => {
                        const row = headers.map(header => {
                            const value = record[header];
                            // Escapar vírgulas e aspas
                            if (typeof value === 'string' && (value.includes(',') || value.includes('"'))) {
                                return `"${value.replace(/"/g, '""')}"`;
                            }
                            return value;
                        });
                        csvRows.push(row.join(','));
                    });
                    
                    dataStr = csvRows.join('\n');
                    filename = `backup-metrics-${new Date().toISOString().slice(0,10)}.csv`;
                    mimeType = 'text/csv';
                } else {
                    // JSON
                    dataStr = JSON.stringify(dataToExport, null, 2);
                    filename = `backup-metrics-${new Date().toISOString().slice(0,10)}.json`;
                    mimeType = 'application/json';
                }
                
                // Criar download
                downloadFile(dataStr, filename, mimeType);
                
            } catch (error) {
                console.error('Erro ao exportar dados:', error);
                alert('Erro ao exportar dados: ' + error.message);
            }
        }
        
        // Exportar dados dos anexos
        function exportAnexosData() {
            // Filtrar dados da partição "anexos" do app-server
            const anexosData = metricsData.filter(d => 
                d.server === 'app-server' && d.disk_partition === 'anexos'
            ).sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            
            if (anexosData.length === 0) {
                alert('Não há dados da unidade "anexos" para exportar');
                return;
            }
            
            // Preparar dados para exportação
            const exportData = anexosData.map(record => {
                const date = new Date(record.timestamp);
                return {
                    Data: date.toLocaleDateString('pt-BR'),
                    Dia: date.toLocaleDateString('pt-BR', { weekday: 'long' }),
                    'Uso (GB)': record.disk_used_gb,
                    'Total (GB)': record.disk_total_gb,
                    '% de Uso': ((record.disk_used_gb / record.disk_total_gb) * 100).toFixed(1),
                    'Disponibilidade (%)': record.availability_percent,
                    'CPU (%)': record.cpu_percent,
                    'Memória (%)': record.memory_percent
                };
            });
            
            // Converter para CSV
            const headers = Object.keys(exportData[0]);
            const csvRows = [headers.join(',')];
            
            exportData.forEach(record => {
                const row = headers.map(header => {
                    const value = record[header];
                    if (typeof value === 'string' && (value.includes(',') || value.includes('"'))) {
                        return `"${value.replace(/"/g, '""')}"`;
                    }
                    return value;
                });
                csvRows.push(row.join(','));
            });
            
            const dataStr = csvRows.join('\n');
            const filename = `anexos-growth-${new Date().toISOString().slice(0,10)}.csv`;
            
            // Criar download
            downloadFile(dataStr, filename, 'text/csv');
        }
        
        // Importar JSON
        async function importJson() {
            const jsonText = document.getElementById('importData').value.trim();
            
            if (!jsonText) {
                alert('Por favor, cole o JSON no campo de texto');
                return;
            }
            
            try {
                const importedData = JSON.parse(jsonText);
                
                if (!Array.isArray(importedData)) {
                    throw new Error('O JSON deve ser um array de objetos');
                }
                
                // Validar estrutura básica dos objetos
                const requiredFields = ['timestamp', 'server', 'cpu_percent', 'memory_percent', 'disk_total_gb', 'disk_used_gb', 'disk_partition', 'availability_percent', 'process_count', 'services_running'];
                
                for (const item of importedData) {
                    for (const field of requiredFields) {
                        if (!(field in item)) {
                            throw new Error(`Objeto inválido: campo ${field} não encontrado`);
                        }
                    }
                }
                
                console.log(`Importando ${importedData.length} registros...`);
                
                // Importar para Firebase
                let successCount = 0;
                let errorCount = 0;
                
                for (const newItem of importedData) {
                    try {
                        // Verificar se já existe no Firebase
                        const existingQuery = await db.collection('metrics')
                            .where('timestamp', '==', newItem.timestamp)
                            .where('server', '==', newItem.server)
                            .where('disk_partition', '==', newItem.disk_partition)
                            .limit(1)
                            .get();
                        
                        if (existingQuery.empty) {
                            await saveMetricToFirebase(newItem);
                            successCount++;
                        } else {
                            console.log(`Registro já existe: ${newItem.timestamp} - ${newItem.server}`);
                        }
                    } catch (error) {
                        console.error('Erro ao importar registro:', error);
                        errorCount++;
                    }
                }
                
                // Também salvar localmente como backup
                importedData.forEach(newItem => {
                    const existingIndex = metricsData.findIndex(d => 
                        d.timestamp === newItem.timestamp && 
                        d.server === newItem.server && 
                        d.disk_partition === newItem.disk_partition
                    );
                    
                    if (existingIndex !== -1) {
                        metricsData[existingIndex] = newItem;
                    } else {
                        metricsData.push(newItem);
                    }
                });
                
                // Ordenar por timestamp
                metricsData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                // Salvar backup local
                localStorage.setItem('serverMetricsData', JSON.stringify(metricsData));
                
                // Atualizar dashboard
                updateDashboard();
                
                // Limpar campo de texto
                document.getElementById('importData').value = '';
                
                alert(`Importação concluída! ${successCount} registros importados, ${errorCount} erros.`);
                
            } catch (error) {
                alert(`Erro ao importar JSON: ${error.message}`);
                console.error('Erro de importação:', error);
            }
        }
        
        // Manipular importação de arquivo
        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    let importedData;
                    
                    // Verificar se é CSV ou JSON
                    if (file.name.endsWith('.csv')) {
                        // Converter CSV para JSON
                        const csvText = e.target.result;
                        importedData = parseCSV(csvText);
                    } else {
                        // JSON
                        importedData = JSON.parse(e.target.result);
                    }
                    
                    if (!Array.isArray(importedData)) {
                        throw new Error('O arquivo deve conter um array de objetos');
                    }
                    
                    // Validar estrutura básica dos objetos
                    const requiredFields = ['timestamp', 'server', 'cpu_percent', 'memory_percent', 'disk_total_gb', 'disk_used_gb', 'disk_partition', 'availability_percent', 'process_count', 'services_running'];
                    
                    for (const item of importedData) {
                        for (const field of requiredFields) {
                            if (!(field in item)) {
                                throw new Error(`Objeto inválido: campo ${field} não encontrado`);
                            }
                        }
                    }
                    
                    // Mesclar dados
                    importedData.forEach(newItem => {
                        const existingIndex = metricsData.findIndex(d => 
                            d.timestamp === newItem.timestamp && 
                            d.server === newItem.server && 
                            d.disk_partition === newItem.disk_partition
                        );
                        
                        if (existingIndex !== -1) {
                            metricsData[existingIndex] = newItem;
                        } else {
                            metricsData.push(newItem);
                        }
                    });
                    
                    // Ordenar por timestamp
                    metricsData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    
                    // Salvar backup local
                    localStorage.setItem('serverMetricsData', JSON.stringify(metricsData));
                    
                    // Tentar salvar no Firebase
                    if (navigator.onLine) {
                        importedData.forEach(async (newItem) => {
                            try {
                                await saveMetricToFirebase(newItem);
                            } catch (error) {
                                console.error('Erro ao salvar no Firebase:', error);
                            }
                        });
                    }
                    
                    // Atualizar dashboard
                    updateDashboard();
                    
                    // Limpar input de arquivo
                    event.target.value = '';
                    
                    alert(`Importação concluída! ${importedData.length} registros processados.`);
                    
                } catch (error) {
                    alert(`Erro ao importar arquivo: ${error.message}`);
                    console.error('Erro de importação:', error);
                }
            };
            
            reader.onerror = function() {
                alert('Erro ao ler o arquivo');
            };
            
            reader.readAsText(file);
        }
        
        // Limpar todos os dados
        async function clearAllData() {
            if (confirm('ATENÇÃO: Tem certeza que deseja excluir TODOS os dados? Esta ação não pode ser desfeita.\n\nIsso irá apagar dados do Firebase e localmente.')) {
                try {
                    // Limpar Firebase
                    if (navigator.onLine) {
                        // Nota: Esta é uma operação perigosa!
                        const metricsSnapshot = await db.collection('metrics').get();
                        const batch = db.batch();
                        
                        metricsSnapshot.forEach(doc => {
                            batch.delete(doc.ref);
                        });
                        
                        await batch.commit();
                        console.log('Dados do Firebase excluídos');
                    }
                    
                    // Limpar dados locais
                    metricsData = [];
                    alertHistory = [];
                    localStorage.removeItem('serverMetricsData');
                    localStorage.removeItem('alertHistoryData');
                    
                    // Atualizar UI
                    updateDashboard();
                    
                    alert('Todos os dados foram excluídos.');
                    
                } catch (error) {
                    console.error('Erro ao excluir dados:', error);
                    alert('Erro ao excluir dados: ' + error.message);
                }
            }
        }
        
        // Restaurar dados de demonstração
        async function resetToDemoData() {
            if (confirm('Restaurar dados de demonstração? Os dados atuais serão substituídos.')) {
                metricsData = [...demoData];
                alertHistory = [];
                
                // Salvar localmente
                localStorage.setItem('serverMetricsData', JSON.stringify(metricsData));
                localStorage.setItem('alertHistoryData', JSON.stringify(alertHistory));
                
                // Tentar salvar no Firebase
                try {
                    // Limpar dados existentes do Firebase
                    if (navigator.onLine) {
                        const metricsSnapshot = await db.collection('metrics').get();
                        const batch = db.batch();
                        metricsSnapshot.forEach(doc => {
                            batch.delete(doc.ref);
                        });
                        await batch.commit();
                        
                        // Adicionar dados demo
                        for (const metric of demoData) {
                            await saveMetricToFirebase(metric);
                        }
                    }
                } catch (error) {
                    console.error('Erro ao restaurar dados no Firebase:', error);
                }
                
                updateDashboard();
                alert('Dados de demonstração restaurados.');
            }
        }
        
        // ==============================================
        // VISUALIZAÇÃO PÚBLICA
        // ==============================================
        
        // Atualizar pré-visualização do painel público
        function updatePublicPreview() {
            updatePublicMetrics();
            updatePublicAnexosChart();
            updatePublicAvailabilityChart();
            updatePublicAlerts();
        }
        
        // Atualizar métricas públicas
        function updatePublicMetrics() {
            const container = document.getElementById('publicMetricsPreview');
            if (!container) return;
            
            // Calcular métricas básicas
            const anexosData = metricsData.filter(d => 
                d.server === 'app-server' && d.disk_partition === 'anexos'
            ).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            const latestAnexos = anexosData[0];
            const anexosUsage = latestAnexos ? latestAnexos.disk_used_gb : 0;
            const anexosTotal = latestAnexos ? latestAnexos.disk_total_gb : 200;
            const anexosPercent = latestAnexos ? (latestAnexos.disk_used_gb / latestAnexos.disk_total_gb) * 100 : 0;
            
            // Determinar status
            const thresholds = getThresholds();
            const anexosStatus = anexosPercent > thresholds.disk ? 'critical' : 
                                (anexosPercent > thresholds.disk * 0.8 ? 'warning' : 'success');
            
            container.innerHTML = `
                <div class="metric-card ${anexosStatus}">
                    <div class="metric-header">
                        <div class="metric-name">Unidade Anexos</div>
                        <div class="status-indicator status-${anexosStatus}"></div>
                    </div>
                    <div class="metric-value">${anexosPercent.toFixed(1)}%</div>
                    <div class="metric-trend">
                        <span>${anexosUsage.toFixed(1)} GB de ${anexosTotal} GB</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-name">Disponibilidade</div>
                        <div class="status-indicator status-ok"></div>
                    </div>
                    <div class="metric-value">99.8%</div>
                    <div class="metric-trend">
                        <span>Média dos servidores</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-name">Status do Sistema</div>
                        <div class="status-indicator status-ok"></div>
                    </div>
                    <div class="metric-value">Normal</div>
                    <div class="metric-trend">
                        <span>Operacional</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-name">Última Atualização</div>
                        <div class="status-indicator status-ok"></div>
                    </div>
                    <div class="metric-value">${new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}</div>
                    <div class="metric-trend">
                        <span>Hoje</span>
                    </div>
                </div>
            `;
        }
        
        // Atualizar gráfico público dos anexos
        function updatePublicAnexosChart() {
            const ctx = document.getElementById('publicAnexosChart');
            if (!ctx) return;
            
            // Filtrar dados da partição "anexos" do app-server
            const anexosData = metricsData.filter(d => 
                d.server === 'app-server' && d.disk_partition === 'anexos'
            ).sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            
            if (anexosData.length === 0) return;
            
            // Extrair últimas 10 entradas
            const recentData = anexosData.slice(-10);
            const dates = recentData.map(d => {
                const date = new Date(d.timestamp);
                return `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth()+1).toString().padStart(2, '0')}`;
            });
            const values = recentData.map(d => d.disk_used_gb);
            
            // Destruir gráfico existente
            if (charts.publicAnexosChart) {
                charts.publicAnexosChart.destroy();
            }
            
            // Criar novo gráfico
            charts.publicAnexosChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Uso de Disco (GB)',
                        data: values,
                        borderColor: '#9b59b6',
                        backgroundColor: 'rgba(155, 89, 182, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Uso de Disco (GB)'
                            }
                        }
                    }
                }
            });
        }
        
        // Atualizar gráfico público de disponibilidade
        function updatePublicAvailabilityChart() {
            const ctx = document.getElementById('publicAvailabilityChart');
            if (!ctx) return;
            
            // Calcular disponibilidade média por servidor
            const appServerData = metricsData.filter(d => d.server === 'app-server');
            const dbServerData = metricsData.filter(d => d.server === 'db-server');
            
            const avgApp = appServerData.length > 0 ? 
                appServerData.reduce((sum, r) => sum + r.availability_percent, 0) / appServerData.length : 99.5;
            const avgDb = dbServerData.length > 0 ? 
                dbServerData.reduce((sum, r) => sum + r.availability_percent, 0) / dbServerData.length : 99.3;
            
            // Destruir gráfico existente
            if (charts.publicAvailabilityChart) {
                charts.publicAvailabilityChart.destroy();
            }
            
            // Criar novo gráfico
            charts.publicAvailabilityChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['app-server', 'db-server'],
                    datasets: [{
                        label: 'Disponibilidade %',
                        data: [avgApp, avgDb],
                        backgroundColor: ['#3498db', '#2ecc71']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 98,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Disponibilidade %'
                            }
                        }
                    }
                }
            });
        }
        
        // Atualizar alertas públicos
        function updatePublicAlerts() {
            const container = document.getElementById('publicAlertsPreview');
            if (!container) return;
            
            // Verificar se há alertas críticos nas últimas 24 horas
            const twentyFourHoursAgo = new Date();
            twentyFourHoursAgo.setHours(twentyFourHoursAgo.getHours() - 24);
            
            const criticalAlerts = alertHistory.filter(a => 
                a.status === 'critical' && 
                new Date(a.timestamp) > twentyFourHoursAgo
            );
            
            let alertsHTML = '';
            
            if (criticalAlerts.length === 0) {
                alertsHTML = '<div class="alert alert-info">Todos os sistemas operando normalmente.</div>';
            } else {
                // Agrupar por servidor
                const alertsByServer = {};
                criticalAlerts.forEach(alert => {
                    if (!alertsByServer[alert.server]) {
                        alertsByServer[alert.server] = [];
                    }
                    alertsByServer[alert.server].push(alert);
                });
                
                Object.entries(alertsByServer).forEach(([server, alerts]) => {
                    const alertTypes = [...new Set(alerts.map(a => a.type))].join(', ');
                    alertsHTML += `
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div>
                                <strong>${server}</strong>: ${alerts.length} alerta(s) - ${alertTypes}
                            </div>
                        </div>
                    `;
                });
            }
            
            container.innerHTML = alertsHTML;
        }
        
        // Abrir painel público em nova janela
        function openPublicDashboard() {
            // Criar conteúdo HTML para o painel público
            const publicHTML = `
                <!DOCTYPE html>
                <html lang="pt-BR">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Monitoramento Público - Servidores</title>
                    <script src="https://cdn.jsdelivr.net/npm/chart.js"><\/script>
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
                    <style>
                        body {
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                            margin: 0;
                            padding: 20px;
                            background-color: #f5f7fa;
                            color: #333;
                        }
                        
                        .container {
                            max-width: 1200px;
                            margin: 0 auto;
                        }
                        
                        .header {
                            text-align: center;
                            margin-bottom: 30px;
                            padding-bottom: 20px;
                            border-bottom: 1px solid #eaeaea;
                        }
                        
                        .header h1 {
                            color: #2c3e50;
                            margin-bottom: 10px;
                        }
                        
                        .header p {
                            color: #7f8c8d;
                        }
                        
                        .metrics-grid {
                            display: grid;
                            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                            gap: 20px;
                            margin-bottom: 30px;
                        }
                        
                        .metric-card {
                            background: white;
                            border-radius: 8px;
                            padding: 20px;
                            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
                            border-left: 4px solid #3498db;
                        }
                        
                        .metric-card.critical { border-left-color: #e74c3c; }
                        .metric-card.warning { border-left-color: #f39c12; }
                        
                        .metric-header {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            margin-bottom: 10px;
                        }
                        
                        .metric-name {
                            font-weight: 600;
                            color: #2c3e50;
                        }
                        
                        .metric-value {
                            font-size: 1.8rem;
                            font-weight: 700;
                            margin: 10px 0;
                        }
                        
                        .chart-container {
                            background: white;
                            border-radius: 10px;
                            padding: 25px;
                            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
                            margin-bottom: 30px;
                        }
                        
                        .chart-wrapper {
                            position: relative;
                            height: 300px;
                            width: 100%;
                        }
                        
                        .alert {
                            padding: 15px;
                            border-radius: 5px;
                            margin-bottom: 15px;
                            display: flex;
                            align-items: center;
                            gap: 15px;
                        }
                        
                        .alert-info {
                            background-color: #e8f4fc;
                            border-left: 4px solid #3498db;
                            color: #2c3e50;
                        }
                        
                        .alert-warning {
                            background-color: #fef5e7;
                            border-left: 4px solid #f39c12;
                            color: #9c6e0f;
                        }
                        
                        .footer {
                            text-align: center;
                            margin-top: 40px;
                            padding-top: 20px;
                            border-top: 1px solid #eaeaea;
                            color: #7f8c8d;
                            font-size: 0.9rem;
                        }
                    <\/style>
                <\/head>
                <body>
                    <div class="container">
                        <div class="header">
                            <h1><i class="fas fa-server"><\/i> Monitoramento Público - Servidores<\/h1>
                            <p>Status atual dos servidores e métricas de desempenho<\/p>
                            <p>Atualizado em: ${new Date().toLocaleString('pt-BR')}<\/p>
                        <\/div>
                        
                        <div id="publicMetrics">
                            <!-- Métricas serão preenchidas por JavaScript -->
                        <\/div>
                        
                        <div class="chart-container">
                            <h3>Uso de Disco - Unidade Anexos (app-server)<\/h3>
                            <div class="chart-wrapper">
                                <canvas id="publicChart1"><\/canvas>
                            <\/div>
                        <\/div>
                        
                        <div class="chart-container">
                            <h3>Disponibilidade dos Servidores<\/h3>
                            <div class="chart-wrapper">
                                <canvas id="publicChart2"><\/canvas>
                            <\/div>
                        <\/div>
                        
                        <div id="publicAlerts">
                            <!-- Alertas serão preenchidos por JavaScript -->
                        <\/div>
                        
                        <div class="footer">
                            <p>Monitoramento de Servidores - Sistema de acompanhamento em tempo real<\/p>
                            <p>Atualizado automaticamente a cada minuto<\/p>
                        <\/div>
                    <\/div>
                    
                    <script>
                        // Dados do painel público
                        const metricsData = ${JSON.stringify(metricsData)};
                        const alertHistory = ${JSON.stringify(alertHistory)};
                        
                        // Atualizar métricas
                        function updatePublicMetrics() {
                            const container = document.getElementById('publicMetrics');
                            if (!container) return;
                            
                            // Filtrar dados da partição "anexos"
                            const anexosData = metricsData.filter(d => 
                                d.server === 'app-server' && d.disk_partition === 'anexos'
                            ).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                            
                            const latestAnexos = anexosData[0];
                            const anexosUsage = latestAnexos ? latestAnexos.disk_used_gb : 0;
                            const anexosTotal = latestAnexos ? latestAnexos.disk_total_gb : 200;
                            const anexosPercent = latestAnexos ? (latestAnexos.disk_used_gb / latestAnexos.disk_total_gb) * 100 : 0;
                            
                            // Determinar status
                            const anexosStatus = anexosPercent > 90 ? 'critical' : 
                                                (anexosPercent > 72 ? 'warning' : '');
                            
                            // Calcular disponibilidade média
                            const appServerData = metricsData.filter(d => d.server === 'app-server');
                            const dbServerData = metricsData.filter(d => d.server === 'db-server');
                            
                            const avgApp = appServerData.length > 0 ? 
                                appServerData.reduce((sum, r) => sum + r.availability_percent, 0) / appServerData.length : 99.5;
                            const avgDb = dbServerData.length > 0 ? 
                                dbServerData.reduce((sum, r) => sum + r.availability_percent, 0) / dbServerData.length : 99.3;
                            
                            container.innerHTML = \`
                                <div class="metrics-grid">
                                    <div class="metric-card \${anexosStatus}">
                                        <div class="metric-header">
                                            <div class="metric-name">Unidade Anexos<\/div>
                                            <div>\${anexosPercent.toFixed(1)}%<\/div>
                                        <\/div>
                                        <div class="metric-value">\${anexosUsage.toFixed(1)} GB<\/div>
                                        <div>\${anexosTotal} GB total<\/div>
                                    <\/div>
                                    
                                    <div class="metric-card">
                                        <div class="metric-header">
                                            <div class="metric-name">Disponibilidade - app-server<\/div>
                                            <div>\${avgApp.toFixed(1)}%<\/div>
                                        <\/div>
                                        <div class="metric-value">Normal<\/div>
                                        <div>Operacional<\/div>
                                    <\/div>
                                    
                                    <div class="metric-card">
                                        <div class="metric-header">
                                            <div class="metric-name">Disponibilidade - db-server<\/div>
                                            <div>\${avgDb.toFixed(1)}%<\/div>
                                        <\/div>
                                        <div class="metric-value">Normal<\/div>
                                        <div>Operacional<\/div>
                                    <\/div>
                                    
                                    <div class="metric-card">
                                        <div class="metric-header">
                                            <div class="metric-name">Total de Registros<\/div>
                                            <div>\${metricsData.length}<\/div>
                                        <\/div>
                                        <div class="metric-value">Monitorando<\/div>
                                        <div>Dados históricos<\/div>
                                    <\/div>
                                <\/div>
                            \`;
                        }
                        
                        // Atualizar gráfico dos anexos
                        function updatePublicChart1() {
                            const ctx = document.getElementById('publicChart1');
                            if (!ctx) return;
                            
                            // Filtrar dados da partição "anexos"
                            const anexosData = metricsData.filter(d => 
                                d.server === 'app-server' && d.disk_partition === 'anexos'
                            ).sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                            
                            if (anexosData.length === 0) return;
                            
                            // Extrair últimas 10 entradas
                            const recentData = anexosData.slice(-10);
                            const dates = recentData.map(d => {
                                const date = new Date(d.timestamp);
                                return \`\${date.getDate().toString().padStart(2, '0')}/\${(date.getMonth()+1).toString().padStart(2, '0')}\`;
                            });
                            const values = recentData.map(d => d.disk_used_gb);
                            
                            new Chart(ctx, {
                                type: 'line',
                                data: {
                                    labels: dates,
                                    datasets: [{
                                        label: 'Uso de Disco (GB)',
                                        data: values,
                                        borderColor: '#9b59b6',
                                        backgroundColor: 'rgba(155, 89, 182, 0.1)',
                                        fill: true,
                                        tension: 0.4
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        legend: { display: false }
                                    }
                                }
                            });
                        }
                        
                        // Atualizar gráfico de disponibilidade
                        function updatePublicChart2() {
                            const ctx = document.getElementById('publicChart2');
                            if (!ctx) return;
                            
                            // Calcular disponibilidade média por servidor
                            const appServerData = metricsData.filter(d => d.server === 'app-server');
                            const dbServerData = metricsData.filter(d => d.server === 'db-server');
                            
                            const avgApp = appServerData.length > 0 ? 
                                appServerData.reduce((sum, r) => sum + r.availability_percent, 0) / appServerData.length : 99.5;
                            const avgDb = dbServerData.length > 0 ? 
                                dbServerData.reduce((sum, r) => sum + r.availability_percent, 0) / dbServerData.length : 99.3;
                            
                            new Chart(ctx, {
                                type: 'bar',
                                data: {
                                    labels: ['app-server', 'db-server'],
                                    datasets: [{
                                        label: 'Disponibilidade %',
                                        data: [avgApp, avgDb],
                                        backgroundColor: ['#3498db', '#2ecc71']
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        legend: { display: false }
                                    },
                                    scales: {
                                        y: {
                                            beginAtZero: false,
                                            min: 98,
                                            max: 100
                                        }
                                    }
                                }
                            });
                        }
                        
                        // Atualizar alertas
                        function updatePublicAlerts() {
                            const container = document.getElementById('publicAlerts');
                            if (!container) return;
                            
                            // Verificar se há alertas críticos nas últimas 24 horas
                            const twentyFourHoursAgo = new Date();
                            twentyFourHoursAgo.setHours(twentyFourHoursAgo.getHours() - 24);
                            
                            const criticalAlerts = alertHistory.filter(a => 
                                a.status === 'critical' && 
                                new Date(a.timestamp) > twentyFourHoursAgo
                            );
                            
                            let alertsHTML = '';
                            
                            if (criticalAlerts.length === 0) {
                                alertsHTML = '<div class="alert alert-info"><i class="fas fa-check-circle"><\/i> Todos os sistemas operando normalmente.<\/div>';
                            } else {
                                // Agrupar por servidor
                                const alertsByServer = {};
                                criticalAlerts.forEach(alert => {
                                    if (!alertsByServer[alert.server]) {
                                        alertsByServer[alert.server] = [];
                                    }
                                    alertsByServer[alert.server].push(alert);
                                });
                                
                                Object.entries(alertsByServer).forEach(([server, alerts]) => {
                                    const alertTypes = [...new Set(alerts.map(a => a.type))].join(', ');
                                    alertsHTML += \`
                                        <div class="alert alert-warning">
                                            <i class="fas fa-exclamation-triangle"><\/i>
                                            <div>
                                                <strong>\${server}<\/strong>: \${alerts.length} alerta(s) - \${alertTypes}
                                            <\/div>
                                        <\/div>
                                    \`;
                                });
                            }
                            
                            container.innerHTML = alertsHTML;
                        }
                        
                        // Inicializar
                        document.addEventListener('DOMContentLoaded', function() {
                            updatePublicMetrics();
                            updatePublicChart1();
                            updatePublicChart2();
                            updatePublicAlerts();
                            
                            // Atualizar a cada minuto
                            setInterval(() => {
                                location.reload();
                            }, 60000);
                        });
                    <\/script>
                <\/body>
                <\/html>
            `;
            
            // Abrir nova janela com o conteúdo
            const newWindow = window.open();
            newWindow.document.write(publicHTML);
            newWindow.document.close();
        }
        
        // ==============================================
        // FUNÇÕES AUXILIARES
        // ==============================================
        
        // Calcular regressão linear
        function calculateLinearRegression(data) {
            // Converter datas para números (dias desde a primeira data)
            const firstDate = new Date(data[0].timestamp);
            const xValues = data.map(d => {
                const date = new Date(d.timestamp);
                return (date - firstDate) / (1000 * 60 * 60 * 24); // Dias
            });
            
            const yValues = data.map(d => d.disk_used_gb);
            
            // Calcular regressão linear
            const n = xValues.length;
            let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;
            
            for (let i = 0; i < n; i++) {
                sumX += xValues[i];
                sumY += yValues[i];
                sumXY += xValues[i] * yValues[i];
                sumXX += xValues[i] * xValues[i];
            }
            
            const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;
            
            // Calcular R²
            let ssTotal = 0, ssResidual = 0;
            const meanY = sumY / n;
            
            for (let i = 0; i < n; i++) {
                const prediction = slope * xValues[i] + intercept;
                ssTotal += Math.pow(yValues[i] - meanY, 2);
                ssResidual += Math.pow(yValues[i] - prediction, 2);
            }
            
            const r2 = 1 - (ssResidual / ssTotal);
            
            return { slope, intercept, r2 };
        }
        
        // Converter CSV para JSON
        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            
            const result = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue;
                
                const values = lines[i].split(',');
                const obj = {};
                
                headers.forEach((header, index) => {
                    let value = values[index] || '';
                    value = value.trim().replace(/^"|"$/g, '');
                    
                    // Converter valores numéricos
                    if (header === 'timestamp') {
                        obj[header] = value;
                    } else if (['cpu_percent', 'memory_percent', 'availability_percent'].includes(header)) {
                        obj[header] = parseFloat(value) || 0;
                    } else if (['disk_total_gb', 'disk_used_gb'].includes(header)) {
                        obj[header] = parseFloat(value) || 0;
                    } else if (['process_count', 'services_running'].includes(header)) {
                        obj[header] = parseInt(value) || 0;
                    } else {
                        obj[header] = value;
                    }
                });
                
                result.push(obj);
            }
            
            return result;
        }
        
        // Baixar arquivo
        function downloadFile(data, filename, mimeType) {
            const blob = new Blob([data], { type: mimeType });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            URL.revokeObjectURL(url);
        }
        
        // ==============================================
        // CONFIGURAÇÃO DOS EVENT LISTENERS
        // ==============================================
        
        // Configurar listeners de eventos
        function setupEventListeners() {
            // Login
            document.getElementById('loginBtn').addEventListener('click', handleLogin);
            document.getElementById('publicLink').addEventListener('click', showPublicPanel);
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // Sidebar toggle
            document.getElementById('sidebarToggle').addEventListener('click', toggleSidebar);
            
            // Navegação
            document.querySelectorAll('.nav-menu a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const pageId = this.getAttribute('href').substring(1);
                    navigateToPage(pageId);
                });
            });
            
            // Dashboard
            document.getElementById('cpuServerFilter').addEventListener('change', updateCpuChart);
            document.getElementById('memoryServerFilter').addEventListener('change', updateMemoryChart);
            
            // Timeline
            document.getElementById('applyTimelineFilters').addEventListener('click', updateTimeline);
            
            // Crescimento Anexos
            document.getElementById('exportAnexosData').addEventListener('click', exportAnexosData);
            
            // Projeções
            document.getElementById('projectionPeriod').addEventListener('change', updateAnnualProjectionChart);
            
            // Servidores (formulário)
            document.getElementById('addSnapshotBtn').addEventListener('click', addSnapshot);
            document.getElementById('clearFormBtn').addEventListener('click', clearForm);
            
            // Alertas
            document.getElementById('saveThresholdsBtn').addEventListener('click', saveThresholds);
            
            // Backup
            document.getElementById('exportDataBtn').addEventListener('click', exportAllData);
            document.getElementById('exportAnexosOnlyBtn').addEventListener('click', exportAnexosData);
            document.getElementById('importJsonBtn').addEventListener('click', importJson);
            document.getElementById('importFileBtn').addEventListener('click', () => document.getElementById('fileInput').click());
            document.getElementById('clearAllDataBtn').addEventListener('click', clearAllData);
            document.getElementById('resetDemoDataBtn').addEventListener('click', resetToDemoData);
            document.getElementById('syncWithFirebaseBtn').addEventListener('click', syncLocalDataToFirebase);
            
            // Visualização Pública
            document.getElementById('openPublicDashboard').addEventListener('click', openPublicDashboard);
            
            // Importação de arquivo
            document.getElementById('fileInput').addEventListener('change', handleFileImport);
            
            // Atualizar dados periodicamente
            setInterval(updateCurrentDate, 60000);
            
            // Monitorar conexão
            window.addEventListener('online', () => {
                console.log('Conexão restaurada');
                updateConnectionStatus();
                if (isLoggedIn) {
                    loadDataFromFirebase();
                }
            });
            
            window.addEventListener('offline', () => {
                console.log('Sem conexão');
                updateConnectionStatus();
            });
        }
        
        // ==============================================
        // INICIALIZAÇÃO DA APLICAÇÃO
        // ==============================================
        
        // Iniciar aplicação quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
